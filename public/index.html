<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GP Basketball Manager</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* === AVATARS ANIM√âS DES FRANCHISES === */

        /* Minotaurs - Taureau qui charge */
        .minotaur-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: charge 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.5));
        }

        @keyframes charge {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            50% { transform: translateX(-3px) rotate(-2deg); }
        }

        /* Krakens - Tentacules qui ondulent */
        .kraken-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: tentacles 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 100, 255, 0.5));
        }

        @keyframes tentacles {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(2deg) scale(1.05); }
            66% { transform: rotate(-2deg) scale(0.95); }
        }

        /* Phoenix - Flammes qui dansent */
        .phoenix-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: flames 2s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(255, 165, 0, 0.7));
        }

        @keyframes flames {
            0%, 100% { transform: translateY(0px) scale(1); }
            25% { transform: translateY(-2px) scale(1.1); }
            75% { transform: translateY(1px) scale(0.9); }
        }

        /* Werewolves - Yeux qui brillent */
        .werewolf-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: glow 4s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.4));
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.4)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 255, 0, 0.8)) brightness(1.2); }
        }

        /* Effet de hover pour tous les avatars */
        .franchise-avatar:hover {
            transform: scale(1.2);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        /* Particules de fond optionnelles */
        .franchise-card {
            position: relative;
            overflow: hidden;
        }

        .franchise-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: sparkle 10s linear infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-20px, -20px) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // D√©finition des badges individuels
        const individualBadges = {
  // === S√âRIES (4 badges) ===
  hotStreak: {
    id: 'hot_streak',
    name: 'Hot Streak',
    emoji: 'üî•',
    description: '5 actions positives d\'affil√©e',
    points: 5,
    rarity: 'bronze'
  },
  tsunami: {
    id: 'tsunami',
    name: 'Tsunami',
    emoji: 'üåä',
    description: '10 actions positives d\'affil√©e',
    points: 10,
    rarity: 'argent'
  },
  unstoppable: {
    id: 'unstoppable',
    name: 'Unstoppable',
    emoji: 'üöÄ',
    description: '15 actions positives d\'affil√©e',
    points: 20,
    rarity: 'or'
  },
  onFire: {
    id: 'on_fire',
    name: 'On Fire',
    emoji: 'üí™',
    description: '2 Hardworker en 2 semaines',
    points: 10,
    rarity: 'argent'
  },
  
  // === PERS√âV√âRANCE (2 badges) ===
  phoenix: {
    id: 'phoenix',
    name: 'Phoenix',
    emoji: 'ü¶Ö',
    description: 'Remonter de -50 √† +50 points',
    points: 20,
    rarity: 'or'
  },
  marathonRunner: {
    id: 'marathon_runner',
    name: 'Marathon Runner',
    emoji: 'üèÉ',
    description: 'Actions positives 5 jours cons√©cutifs',
    points: 5,
    rarity: 'bronze'
  },
  
  // === SOCIAUX/√âQUIPE (3 badges) ===
  teamCaptain: {
    id: 'team_captain',
    name: 'Team Captain',
    emoji: 'üëë',
    description: 'Meilleur de sa franchise pendant 1 semaine',
    points: 10,
    rarity: 'argent'
  },
  veteran: {
    id: 'veteran',
    name: 'Veteran',
    emoji: 'üéñÔ∏è',
    description: 'Top 3 de sa franchise pendant 2 mois',
    points: 20,
    rarity: 'or'
  },
  teamPlayer: {
    id: 'team_player',
    name: 'Team Player',
    emoji: 'ü§ù',
    description: 'Sa franchise gagne le + de points en 1 semaine',
    points: 5,
    rarity: 'bronze'
  },
  
  // === SP√âCIAUX & RARES (3 badges) ===
  showtime: {
    id: 'showtime',
    name: 'Showtime',
    emoji: 'üé™',
    description: 'Recevoir F√©licitations 3 fois',
    points: 35,
    rarity: 'diamant'
  },
  halloweenSpirit: {
    id: 'halloween_spirit',
    name: 'Halloween Spirit',
    emoji: 'üéÉ',
    description: '3 Actions positives semaine Halloween',
    points: 50,
    rarity: 'legendaire'
  },
  christmasMagic: {
    id: 'christmas_magic',
    name: 'Christmas Magic',
    emoji: 'üéÑ',
    description: 'Actions positives pendant les f√™tes',
    points: 50,
    rarity: 'legendaire'
  }
};

       const collectiveBadges = {

  // === PERFORMANCES (4 badges) ===
  rocketLaunch: {
    id: 'rocket_launch',
    name: 'Rocket Launch',
    emoji: 'üöÄ',
    description: '+80 points collectifs en 1 semaine',
    points: 20,
    rarity: 'bronze'
  },
  tidalWave: {
    id: 'tidal_wave',
    name: 'Tidal Wave',
    emoji: 'üåä',
    description: '+200 points collectifs en 1 mois',
    points: 100,
    rarity: 'or'
  },
  lightningStrike: {
    id: 'lightning_strike',
    name: 'Lightning Strike',
    emoji: '‚ö°',
    description: 'Tous les membres gagnent points m√™me jour',
    points: 20,
    rarity: 'bronze'
  },
  houseOnFire: {
    id: 'house_on_fire',
    name: 'House on Fire',
    emoji: 'üî•',
    description: '80% membres actions positives en 1 semaine',
    points: 50,
    rarity: 'argent'
  },
  
  // === SOLIDARIT√â (4 badges) ===
  unitedWeStand: {
    id: 'united_we_stand',
    name: 'United We Stand',
    emoji: 'ü§ù',
    description: 'Aucun membre n√©gatif pendant 2 semaines',
    points: 50,
    rarity: 'argent'
  },
  perfectBalance: {
    id: 'perfect_balance',
    name: 'Perfect Balance',
    emoji: '‚öñÔ∏è',
    description: 'Tous membres entre 25-75 points',
    points: 100,
    rarity: 'or'
  },
  harmony: {
    id: 'harmony',
    name: 'Harmony',
    emoji: 'üåà',
    description: '√âcart <50 points entre 1er et dernier',
    points: 50,
    rarity: 'argent'
  }
};

        // Fonction pour obtenir la couleur selon la raret√©
        const getRarityColor = (rarity) => {
          switch(rarity) {
            case 'common': return 'border-gray-400';
            case 'rare': return 'border-blue-400';
            case 'epic': return 'border-purple-400';
            case 'legendary': return 'border-yellow-400';
            default: return 'border-gray-400';
          }
        };

        // Composant BadgeDisplay
        const BadgeDisplay = ({ badges }) => {
  if (!badges || badges.length === 0) return null;
  
  return (
    <div className="flex flex-wrap gap-1 mt-2">
      {badges.map((badge, index) => (
        <span 
          key={badge.badge_id || badge.id || index} 
          className="text-xl" 
          title={`${badge.badge_name || badge.name} - ${badge.description || ''}`}
        >
          {badge.badge_emoji || badge.emoji || 'üèÖ'}
        </span>
      ))}
    </div>
  );
};

        // Composant NotificationSystem
        const NotificationSystem = ({ notifications }) => {
          if (!notifications || notifications.length === 0) return null;
          
          return (
            <div className="fixed top-4 right-4 z-50 space-y-2 max-w-sm">
              {notifications.map((notif, index) => (
                <div
                  key={index}
                  className="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-2xl animate-pulse"
                >
                  {notif}
                </div>
              ))}
            </div>
          );
        };

        const App = () => {
          const [currentView, setCurrentView] = useState('home');
          const [userType, setUserType] = useState(null);
          const [players, setPlayers] = useState([]);
          const [selectedPlayer, setSelectedPlayer] = useState(null);
          const [selectedPlayerHistory, setSelectedPlayerHistory] = useState(null);
          const [playerHistory, setPlayerHistory] = useState([]);
          const [loading, setLoading] = useState(false);
          const [password, setPassword] = useState('');
          const [loginError, setLoginError] = useState('');
          const [teacherName, setTeacherName] = useState('');
          const [selectedStudent, setSelectedStudent] = useState('');
          const [newStudentName, setNewStudentName] = useState('');
          const [newStudentFranchise, setNewStudentFranchise] = useState('Minotaurs');
          const [searchName, setSearchName] = useState('');
          const [foundPlayer, setFoundPlayer] = useState(null);
          const [searchHistory, setSearchHistory] = useState([]);
          const [showEvolutionChart, setShowEvolutionChart] = useState(false);
          const [chartData, setChartData] = useState(null);
          const [chartType, setChartType] = useState('player');
          // √âtats pour les badges
          const [playerBadges, setPlayerBadges] = useState({});
          const [franchiseBadges, setFranchiseBadges] = useState({});
          const [notifications, setNotifications] = useState([]);
          
          
          // Fonction pour obtenir le grade basketball selon le score
          const getBadge = (score) => {
            // Grade Ultime
            if (score >= 250) return { 
              emoji: 'üêê', 
              name: 'GOAT', 
              fullName: 'Greatest Of All Time',
              color: 'text-purple-300',
              bgColor: 'from-purple-600 to-purple-800',
              description: 'Le plus grand de tous les temps'
            };
            
            // Grades Elite
            if (score >= 200) return { 
              emoji: 'üèõÔ∏è', 
              name: 'Hall of Fame', 
              fullName: 'Hall of Fame',
              color: 'text-yellow-300',
              bgColor: 'from-yellow-500 to-yellow-700',
              description: 'L√©gende du sport'
            };
            if (score >= 150) return { 
              emoji: 'üî•', 
              name: 'Superstar', 
              fullName: 'Superstar',
              color: 'text-orange-300',
              bgColor: 'from-orange-500 to-red-600',
              description: 'Ph√©nom√®ne basketball'
            };
            
            // Grades Confirm√©s
            if (score >= 100) return { 
              emoji: 'üåü', 
              name: 'All-Star', 
              fullName: 'All-Star',
              color: 'text-blue-300',
              bgColor: 'from-blue-500 to-blue-700',
              description: 'S√©lectionn√© parmi l\'√©lite'
            };
            if (score >= 75) return { 
              emoji: 'üíé', 
              name: 'Franchise Player', 
              fullName: 'Franchise Player',
              color: 'text-cyan-300',
              bgColor: 'from-cyan-500 to-blue-600',
              description: 'Pilier de l\'√©quipe'
            };
            
            // Grades D√©veloppement
            if (score >= 50) return { 
              emoji: '‚≠ê', 
              name: 'Starting Five', 
              fullName: 'Starting Five',
              color: 'text-green-300',
              bgColor: 'from-green-500 to-green-700',
              description: 'Titulaire indiscutable'
            };
            if (score >= 25) return { 
              emoji: 'üèÉ', 
              name: 'Sixth Man', 
              fullName: 'Sixth Man',
              color: 'text-emerald-300',
              bgColor: 'from-emerald-500 to-green-600',
              description: 'Premier rempla√ßant de qualit√©'
            };
            
            // Grades D√©butants
            if (score >= 10) return { 
              emoji: 'üèÄ', 
              name: 'Rookie', 
              fullName: 'Rookie',
              color: 'text-amber-300',
              bgColor: 'from-amber-500 to-orange-500',
              description: 'D√©butant prometteur'
            };
            if (score >= 0) return { 
              emoji: 'üë∂', 
              name: 'Freshman', 
              fullName: 'Freshman',
              color: 'text-yellow-300',
              bgColor: 'from-yellow-400 to-amber-500',
              description: 'Premi√®re ann√©e, apprend les bases'
            };
            
            // Grades N√©gatifs
            if (score >= -25) return { 
              emoji: 'üìâ', 
              name: 'Plot', 
              fullName: 'Plot',
              color: 'text-gray-400',
              bgColor: 'from-gray-500 to-gray-700',
              description: 'Personnage sans importance'
            };
            if (score >= -50) return { 
              emoji: 'ü™ë', 
              name: 'Benchwarmer', 
              fullName: 'Benchwarmer',
              color: 'text-red-400',
              bgColor: 'from-red-500 to-red-700',
              description: 'Clou√© sur le banc'
            };
            
            // Pire niveau
            return { 
              emoji: 'üóëÔ∏è', 
              name: 'Scrub', 
              fullName: 'Scrub',
              color: 'text-red-600',
              bgColor: 'from-red-700 to-red-900',
              description: 'Le pire niveau possible'
            };
          };

          // Fonction pour obtenir l'avatar anim√© de la franchise
          const getFranchiseAvatar = (franchise) => {
            const avatars = {
              Minotaurs: { emoji: 'üêÇ', class: 'minotaur-avatar', name: 'Taureau Enrag√©' },
              Krakens: { emoji: 'üêô', class: 'kraken-avatar', name: 'Kraken des Profondeurs' },
              Phoenix: { emoji: 'üî•', class: 'phoenix-avatar', name: 'Phoenix √âternel' },
              Werewolves: { emoji: 'üê∫', class: 'werewolf-avatar', name: 'Loup-Garou' }
            };
            return avatars[franchise] || { emoji: '‚ö°', class: 'franchise-avatar', name: 'Guerrier' };
          };

          // Actions positives et n√©gatives
          const positiveActions = [
  // ====== CAT√âGORIE SPORT ====== 
  { label: 'üèÄ Hardworker', points: 6, category: 'sport' },
  { label: 'üèÄ Bon entrainement club', points: 4, category: 'sport' },
  { label: 'üèÜ Victoire weekend (R√©gion/France)', points: 6, category: 'sport' },
  { label: 'ü•à D√©faite weekend (R√©gion/France)', points: 2, category: 'sport' },
  { label: 'üèÖ Victoire weekend (D√©partement)', points: 4, category: 'sport' },
  { label: 'üéØ D√©faite weekend (D√©partement)', points: 1, category: 'sport' },
  { label: '‚≠ê Extra basket (cross, AS...) - Excellent', points: 10, category: 'sport' },
  { label: '‚≠ê Extra basket (cross, AS...) - Tr√®s bien', points: 6, category: 'sport' },
  { label: '‚≠ê Extra basket (cross, AS...) - Bien', points: 3, category: 'sport' },
  { label: 'üéñÔ∏è Parcours s√©lection', points: 10, category: 'sport' },
  { label: 'üåü Tournoi des √©toiles', points: 25, category: 'sport' },
  { label: 'üí™ Entrainements facultatifs', points: 3, category: 'sport' },
  { label: 'üìä Table de marque/Arbitrage weekend', points: 5, category: 'sport' },
  
  // ====== CAT√âGORIE ACAD√âMIQUE ======
  { label: 'üìö Observation positive', points: 5, category: 'academic' },
  { label: 'üìö Participation active en classe', points: 4, category: 'academic' },
  { label: 'üìö Travail de qualit√© (oral/√©crit)', points: 4, category: 'academic' },
  { label: 'üìö Activit√©s facultatives (sentinelle)', points: 5, category: 'academic' },
  { label: 'üìö Activit√©s facultatives (ateliers devoirs)', points: 4, category: 'academic' },
  { label: 'üìö Activit√©s facultatives (d√©l√©gu√©)', points: 6, category: 'academic' },
  { label: 'üìö Activit√©s facultatives (conseil admin)', points: 8, category: 'academic' },
  { label: 'üèÜ F√©licitations', points: 25, category: 'academic' },
  { label: 'üéñÔ∏è Compliments', points: 15, category: 'academic' },
  { label: 'üëç Encouragements', points: 10, category: 'academic' },
  
  // === BONUS FLEXIBLES ===
  { label: 'Bonus Sport', points: 2, category: 'sport' },
  { label: 'Bonus Scolaire', points: 2, category: 'academic' },
  { label: 'Bonus Sport', points: 3, category: 'sport' },
  { label: 'Bonus Scolaire', points: 3, category: 'academic' },
  { label: 'Bonus Sport', points: 5, category: 'sport' },
  { label: 'Bonus Scolaire', points: 5, category: 'academic' },
  { label: 'Bonus Sport', points: 10, category: 'sport' },
  { label: 'Bonus Scolaire', points: 10, category: 'academic' }
];
          
              const negativeActions = [
  // ====== CAT√âGORIE SPORT ====== 
  { label: 'Mauvaise attitude/retard entrainement', points: -4, category: 'sport' },
  { label: 'Absences r√©p√©t√©es/non justifi√©es club', points: -4, category: 'sport' },
  
  // ====== CAT√âGORIE ACAD√âMIQUE ======
  { label: 'Observation n√©gative', points: -5, category: 'academic' },
  { label: 'Exclusion de cours', points: -8, category: 'academic' },
  { label: 'Exclusion temporaire √©tablissement', points: -15, category: 'academic' },
  { label: 'Travail non fait', points: -3, category: 'academic' },
  { label: 'Retard/absence non justifi√©e', points: -3, category: 'academic' },
  { label: 'Mauvaise attitude en classe (perturbe)', points: -5, category: 'academic' },
  
  // === P√âNALIT√âS FLEXIBLES ===
  { label: 'P√©nalit√© Sport', points: -2, category: 'sport' },
  { label: 'P√©nalit√© Scolaire', points: -2, category: 'academic' },
  { label: 'P√©nalit√© Sport', points: -3, category: 'sport' },
  { label: 'P√©nalit√© Scolaire', points: -3, category: 'academic' },
  { label: 'P√©nalit√© Sport', points: -5, category: 'sport' },
  { label: 'P√©nalit√© Scolaire', points: -5, category: 'academic' }
];

          // Couleurs des franchises
          const franchiseColors = {
            Minotaurs: 'from-red-600 to-red-800',
            Krakens: 'from-blue-600 to-blue-800',
            Phoenix: 'from-orange-600 to-orange-800',
            Werewolves: 'from-green-600 to-green-800'
          };

          // V√©rifier le mot de passe professeur
          const verifyTeacher = async () => {
            if (!password.trim()) {
              setLoginError('Veuillez entrer un mot de passe');
              return;
            }
            
            try {
              const response = await fetch('/api/verify-teacher', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
              });
              
              const data = await response.json();
              if (data.success) {
                setUserType('teacher');
                setCurrentView('teacher-dashboard');
                setLoginError('');
              } else {
                setLoginError('Mot de passe incorrect');
              }
            } catch (error) {
              setLoginError('Erreur de connexion');
            }
          };

          // Charger les joueurs
          const loadPlayers = async () => {
            try {
              const response = await fetch('/api/players');
              const data = await response.json();
              setPlayers(data);
            } catch (error) {
              console.error('Erreur lors du chargement des joueurs:', error);
            }
          };

          // Ajouter des points (professeurs uniquement)
          const addPoints = async (playerName, points, action) => {
            setLoading(true);
            try {
              const response = await fetch('/api/add-points', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ playerName, points, action, teacherName })
              });
              
              if (response.ok) {
                await loadPlayers();
                setExpandedDropdown(null);
              }
            } catch (error) {
              console.error('Erreur lors de l\'ajout de points:', error);
            }
            setLoading(false);
          };

          // Charger l'historique d'un joueur
          const loadPlayerHistory = async (playerName) => {
            try {
              const response = await fetch(`/api/history/${encodeURIComponent(playerName)}`);
              const data = await response.json();
              setPlayerHistory(data);
              setSelectedPlayerHistory(playerName);
            } catch (error) {
              console.error('Erreur lors du chargement de l\'historique:', error);
            }
          };

          // Annuler la derni√®re action (professeurs uniquement)
          const undoLastAction = async (playerName) => {
            setLoading(true);
            try {
              const response = await fetch(`/api/undo-last/${encodeURIComponent(playerName)}`, {
                method: 'DELETE',
              });
              
              if (response.ok) {
                await loadPlayers();
              }
            } catch (error) {
              console.error('Erreur lors de l\'annulation:', error);
            }
            setLoading(false);
          };

          // Ajouter un √©l√®ve (professeurs uniquement)
          const addStudent = async () => {
            if (!newStudentName.trim()) {
              alert('Veuillez entrer un nom');
              return;
            }
            
            try {
              const response = await fetch('/api/add-student', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                  name: newStudentName.trim(), 
                  franchise: newStudentFranchise 
                })
              });
              
              if (response.ok) {
                setNewStudentName('');
                await loadPlayers();
                alert('√âl√®ve ajout√© avec succ√®s !');
              } else {
                const error = await response.json();
                alert(error.error || 'Erreur lors de l\'ajout');
              }
            } catch (error) {
              alert('Erreur lors de l\'ajout de l\'√©l√®ve');
            }
          };

          // Supprimer un √©l√®ve (professeurs uniquement)
          const removeStudent = async (playerName) => {
            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer ${playerName} ? Cette action est irr√©versible.`)) {
              return;
            }
            
            try {
              const response = await fetch(`/api/remove-student/${encodeURIComponent(playerName)}`, {
                method: 'DELETE'
              });
              
              if (response.ok) {
                await loadPlayers();
                alert('√âl√®ve supprim√© avec succ√®s');
              }
            } catch (error) {
              alert('Erreur lors de la suppression');
            }
          };

          useEffect(() => {
            if (userType) {
              loadPlayers();
              const interval = setInterval(loadPlayers, 10000);
              return () => clearInterval(interval);
            }
          }, [userType]);

          // Obtenir les joueurs tri√©s par score pour une franchise
          const getSortedPlayers = (franchise) => {
            return players
              .filter(player => player.franchise === franchise)
              .sort((a, b) => b.score - a.score);
          };

          // Obtenir le classement des franchises
          const getFranchiseRankings = () => {
            const franchiseScores = {};
            ['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].forEach(franchise => {
              franchiseScores[franchise] = players
                .filter(player => player.franchise === franchise)
                .reduce((total, player) => total + player.score, 0);
            });
            
            return Object.entries(franchiseScores)
              .sort(([,a], [,b]) => b - a)
              .map(([franchise, score], index) => ({ franchise, score, rank: index + 1 }));
          };

          // Obtenir le classement g√©n√©ral des joueurs
          const getGeneralPlayerRankings = () => {
            return [...players].sort((a, b) => b.score - a.score);
          };

          // PAGE D'ACCUEIL - CHOIX DU TYPE D'UTILISATEUR
          if (currentView === 'home') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <h1 className="text-6xl font-bold text-center text-white mb-4">
                    üèÜ Syst√®me de Gestion Scolaire üèÜ
                  </h1>
                  <p className="text-xl text-center text-purple-200 mb-12">
                    Choisissez votre type d'acc√®s
                  </p>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <button
                      onClick={() => setCurrentView('teacher-login')}
                      className="group relative overflow-hidden bg-gradient-to-r from-emerald-600 to-emerald-800 hover:from-emerald-500 hover:to-emerald-700 text-white p-8 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                      <div className="relative z-10 flex flex-col items-center">
                        <div className="text-6xl mb-4">üë®‚Äçüè´</div>
                        <h2 className="text-3xl font-bold mb-2">PROFESSEUR</h2>
                        <p className="text-emerald-100">Gestion compl√®te</p>
                        <p className="text-sm text-emerald-200 mt-2">üîê Mot de passe requis</p>
                      </div>
                    </button>
                    
                    <button
                      onClick={() => {
                        setUserType('student');
                        setCurrentView('student-dashboard');
                      }}
                      className="group relative overflow-hidden bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-8 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                      <div className="relative z-10 flex flex-col items-center">
                        <div className="text-6xl mb-4">üë®‚Äçüéì</div>
                        <h2 className="text-3xl font-bold mb-2">√âL√àVE</h2>
                        <p className="text-amber-100">Consultation des scores</p>
                        <p className="text-sm text-amber-200 mt-2">üëÅÔ∏è Lecture seule</p>
                      </div>
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // PAGE DE CONNEXION PROFESSEUR
          if (currentView === 'teacher-login') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8 flex items-center justify-center">
                <div className="bg-white/10 backdrop-blur-sm rounded-xl p-8 max-w-md w-full">
                  <h2 className="text-3xl font-bold text-white text-center mb-8">
                    üîê Connexion Professeur
                  </h2>
                  
                  <div className="space-y-6">
                    <div>
                      <label className="block text-white text-sm font-bold mb-2">
                        Nom (optionnel)
                      </label>
                      <input
                        type="text"
                        value={teacherName}
                        onChange={(e) => setTeacherName(e.target.value)}
                        className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                        placeholder="Votre nom..."
                      />
                    </div>
                    
                    <div>
                      <label className="block text-white text-sm font-bold mb-2">
                        Mot de passe *
                      </label>
                      <input
                        type="password"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && verifyTeacher()}
                        className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                        placeholder="Mot de passe..."
                      />
                    </div>
                    
                    {loginError && (
                      <div className="text-red-300 text-sm text-center">
                        {loginError}
                      </div>
                    )}
                    
                    <div className="flex space-x-4">
                      <button
                        onClick={() => setCurrentView('home')}
                        className="flex-1 bg-gray-600 hover:bg-gray-500 text-white py-3 rounded-lg transition-colors"
                      >
                        ‚Üê Retour
                      </button>
                      <button
                        onClick={verifyTeacher}
                        className="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white py-3 rounded-lg transition-colors"
                      >
                        Se connecter
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // TABLEAU DE BORD PROFESSEUR
          if (currentView === 'teacher-dashboard') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">
                      üë®‚Äçüè´ Tableau de Bord Professeur
                      {teacherName && <span className="text-2xl text-purple-200"> - {teacherName}</span>}
                    </h1>
                    <button
                      onClick={() => {
                        setCurrentView('home');
                        setUserType(null);
                        setPassword('');
                        setTeacherName('');
                      }}
                      className="bg-red-600 hover:bg-red-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      üö™ D√©connexion
                    </button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <button
                      onClick={() => setCurrentView('teacher-players')}
                      className="bg-gradient-to-r from-emerald-600 to-emerald-800 hover:from-emerald-500 hover:to-emerald-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">üë•</div>
                      <h3 className="text-xl font-bold">Gestion des Points</h3>
                      <p className="text-emerald-100 text-sm">Ajouter/retirer des points</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('teacher-admin')}
                      className="bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">‚öôÔ∏è</div>
                      <h3 className="text-xl font-bold">Administration</h3>
                      <p className="text-blue-100 text-sm">G√©rer les √©l√®ves</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('rankings')}
                      className="bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">üèÜ</div>
                      <h3 className="text-xl font-bold">Classements</h3>
                      <p className="text-amber-100 text-sm">Voir les r√©sultats</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('badges')}
                      className="bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">üèÖ</div>
                      <h3 className="text-xl font-bold">Badges</h3>
                      <p className="text-purple-100 text-sm">Voir tous les badges</p>
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h3 className="text-2xl font-bold text-white mb-4">üìä Statistiques Rapides</h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const franchisePlayers = getSortedPlayers(franchise);
                        const totalPoints = franchisePlayers.reduce((sum, player) => sum + player.score, 0);
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg text-center franchise-card`}>
                            <div className="flex items-center justify-center mb-2">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                            </div>
                            <h4 className="font-bold text-white">{franchise}</h4>
                            <div className="text-2xl font-bold text-white">{totalPoints}</div>
                            <div className="text-sm text-white/80">{franchisePlayers.length} √©l√®ves</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // GESTION DES POINTS PROFESSEUR
          if (currentView === 'teacher-players') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-7xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">üë• Gestion des Points</h1>
                    <div className="flex space-x-4">
                      {loading && <div className="text-white">‚è≥ Chargement...</div>}
                      <button
                        onClick={() => setCurrentView('teacher-dashboard')}
                        className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                      >
                        ‚Üê Retour Tableau de Bord
                      </button>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6">
                    {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                      const avatar = getFranchiseAvatar(franchise);
                      return (
                        <div key={franchise} className="bg-white/10 backdrop-blur-sm rounded-xl p-6 franchise-card">
                          <h2 className={`text-2xl font-bold text-white mb-4 text-center bg-gradient-to-r ${franchiseColors[franchise]} p-3 rounded-lg flex items-center justify-center space-x-2`}>
                            <span className={`franchise-avatar ${avatar.class}`}>
                              {avatar.emoji}
                            </span>
                            <span>{franchise}</span>
                          </h2>
                          <div className="space-y-3">
                            {getSortedPlayers(franchise).map(player => (
                              <div key={player.name} className="bg-white/20 rounded-lg p-3">
                                <div className="flex justify-between items-center mb-2">
                                  <button
                                    onClick={() => loadPlayerHistory(player.name)}
                                    className="text-white font-semibold hover:text-yellow-300 transition-colors flex items-center space-x-1"
                                  >
                                    <span>{player.name}</span>
                                    <span>üìã</span>
                                  </button>
                                  <div className="flex items-center space-x-2">
                                    <div className="flex items-center space-x-1">
                                      <span className={`text-2xl ${getBadge(player.score).emoji}`}>
                                        {getBadge(player.score).emoji}
                                      </span>
                                      <span className="text-white font-bold">
                                        {player.score} pts
                                      </span>
                                    </div>
                                    <button
                                      onClick={() => undoLastAction(player.name)}
                                      className="bg-red-500 hover:bg-red-400 text-white px-2 py-1 rounded text-xs"
                                      title="Annuler derni√®re action"
                                    >
                                      ‚Ü∫
                                    </button>
                                  </div>
                                </div>
                                {/* Affichage des badges */}
                                  {console.log('Player:', player.name, 'Badges:', player.badges)}
                                <BadgeDisplay badges={player.badges || []} />
<div className="relative">
                                  <button
  onClick={() => setSelectedPlayer(player)}
  className="w-full bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded"
  disabled={loading}
>
  Attribuer des points
</button>
                                  
                                  {selectedPlayer && (
  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto">
      <div className="flex justify-between items-center mb-4">
        <h3 className="text-lg font-semibold">
          Points pour {selectedPlayer.name}
        </h3>
        <button
          onClick={() => setSelectedPlayer(null)}
          className="text-gray-500 hover:text-gray-700 text-xl"
        >
          √ó
        </button>
      </div>
      
      <div className="space-y-3">
        <div className="text-green-700 font-semibold mb-2">Points positifs:</div>
        {positiveActions.map((action, index) => (
          <button
            key={`pos-${index}`}
            onClick={() => {
              addPoints(selectedPlayer.name, action.points, action.label);
              setSelectedPlayer(null);
            }}
            className="w-full text-left px-3 py-2 hover:bg-green-100 rounded text-sm flex justify-between"
            disabled={loading}
          >
            <span>{action.label}</span>
            <span className="text-green-600 font-bold">+{action.points}</span>
          </button>
        ))}
        
        <div className="text-red-700 font-semibold mb-2 mt-4">Points n√©gatifs:</div>
        {negativeActions.map((action, index) => (
          <button
            key={`neg-${index}`}
            onClick={() => {
              addPoints(selectedPlayer.name, action.points, action.label);
              setSelectedPlayer(null);
            }}
            className="w-full text-left px-3 py-2 hover:bg-red-100 rounded text-sm flex justify-between"
            disabled={loading}
          >
            <span>{action.label}</span>
            <span className="text-red-600 font-bold">{action.points}</span>
          </button>
        ))}
      </div>
    </div>
  </div>
)}
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          }
          // ADMINISTRATION PROFESSEUR
          if (currentView === 'teacher-admin') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">‚öôÔ∏è Administration des √âl√®ves</h1>
                    <button
                      onClick={() => setCurrentView('teacher-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ‚Üê Retour Tableau de Bord
                    </button>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        ‚ûï Ajouter un √âl√®ve
                      </h2>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            Nom de l'√©l√®ve
                          </label>
                          <input
                            type="text"
                            value={newStudentName}
                            onChange={(e) => setNewStudentName(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                            placeholder="Pr√©nom Nom..."
                          />
                        </div>
                        
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            Franchise
                          </label>
                          <select
                            value={newStudentFranchise}
                            onChange={(e) => setNewStudentFranchise(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white border border-white/30 focus:border-white/70 focus:outline-none"
                          >
                            <option value="Minotaurs" className="text-black">Minotaurs</option>
                            <option value="Krakens" className="text-black">Krakens</option>
                            <option value="Phoenix" className="text-black">Phoenix</option>
                            <option value="Werewolves" className="text-black">Werewolves</option>
                          </select>
                        </div>
                        
                        <button
                          onClick={addStudent}
                          className="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg transition-colors font-bold"
                        >
                          ‚ûï Ajouter l'√âl√®ve
                        </button>
                      </div>
                    </div>

                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        üóëÔ∏è Supprimer un √âl√®ve
                      </h2>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            S√©lectionner un √©l√®ve
                          </label>
                          <select
                            value={selectedStudent}
                            onChange={(e) => setSelectedStudent(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white border border-white/30 focus:border-white/70 focus:outline-none"
                          >
                            <option value="" className="text-black">-- Choisir un √©l√®ve --</option>
                            {players
                              .sort((a, b) => a.name.localeCompare(b.name))
                              .map(player => (
                                <option key={player.name} value={player.name} className="text-black">
                                  {player.name} ({player.franchise})
                                </option>
                              ))}
                          </select>
                        </div>
                        
                        <button
                          onClick={() => selectedStudent && removeStudent(selectedStudent)}
                          disabled={!selectedStudent}
                          className="w-full bg-red-600 hover:bg-red-500 disabled:bg-gray-500 disabled:cursor-not-allowed text-white py-3 rounded-lg transition-colors font-bold"
                        >
                          üóëÔ∏è Supprimer l'√âl√®ve
                        </button>
                        
                        <p className="text-red-300 text-sm text-center">
                          ‚ö†Ô∏è Cette action est irr√©versible !
                        </p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-8 bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">
                      üìã Liste Actuelle des √âl√®ves
                    </h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg franchise-card`}>
                            <div className="flex items-center justify-center mb-3">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                              <h3 className="text-xl font-bold text-white ml-2">{franchise}</h3>
                            </div>
                            <div className="space-y-2">
                              {getSortedPlayers(franchise).map(player => (
                                <div key={player.name} className="bg-white/20 p-2 rounded text-white text-sm">
                                  <div className="flex justify-between items-center">
                                    <span>{player.name}</span>
                                    <span className="font-bold">{player.score} pts</span>
                                  </div>
                                </div>
                              ))}
                            </div>
                            <div className="text-center mt-3 text-white/80 text-sm">
                              {getSortedPlayers(franchise).length} √©l√®ve(s)
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // TABLEAU DE BORD √âL√àVE
          if (currentView === 'student-dashboard') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">üë®‚Äçüéì Espace √âl√®ve</h1>
                    <button
                      onClick={() => {
                        setCurrentView('home');
                        setUserType(null);
                      }}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ‚Üê Retour Accueil
                    </button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button
                      onClick={() => setCurrentView('student-search')}
                      className="bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">üîç</div>
                      <h3 className="text-xl font-bold">Mon Score</h3>
                      <p className="text-blue-100 text-sm">Voir mon historique personnel</p>
                    </button>

                    <button
                      onClick={() => setCurrentView('badges')}
                      className="bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">üèÖ</div>
                      <h3 className="text-xl font-bold">Badges</h3>
                      <p className="text-purple-100 text-sm">D√©couvrir les badges</p>
                    </button>

                      <button
  onClick={() => setCurrentView('grades')}
  className="bg-gradient-to-r from-orange-600 to-orange-800 hover:from-orange-500 hover:to-orange-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
>
  <div className="text-4xl mb-2">üèÄ</div>
  <h3 className="text-xl font-bold">Grades</h3>
  <p className="text-orange-100 text-sm">D√©couvrir les grades</p>
</button>
                    
                    <button
                      onClick={() => setCurrentView('rankings')}
                      className="bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">üèÜ</div>
                      <h3 className="text-xl font-bold">Classements</h3>
                      <p className="text-amber-100 text-sm">Voir tous les classements</p>
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h3 className="text-2xl font-bold text-white mb-6 text-center">
                      üè† Les Quatre Franchises
                    </h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const franchisePlayers = getSortedPlayers(franchise);
                        const totalPoints = franchisePlayers.reduce((sum, player) => sum + player.score, 0);
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg text-center franchise-card`}>
                            <div className="flex items-center justify-center mb-2">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                            </div>
                            <h4 className="font-bold text-white text-lg">{franchise}</h4>
                            <div className="text-2xl font-bold text-white">{totalPoints}</div>
                            <div className="text-sm text-white/80">{franchisePlayers.length} √©l√®ves</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // RECHERCHE √âL√àVE
          if (currentView === 'student-search') {
            
            const searchPlayer = async () => {
              if (!searchName.trim()) {
                alert('Veuillez entrer votre nom');
                return;
              }

              try {
                const response = await fetch(`/api/player/${encodeURIComponent(searchName.trim())}`);
                if (response.ok) {
                  const player = await response.json();
                  setFoundPlayer(player);
                  
                  const historyResponse = await fetch(`/api/history/${encodeURIComponent(searchName.trim())}`);
                  const history = await historyResponse.json();
                  setSearchHistory(history);
                } else {
                  setFoundPlayer(null);
                  setSearchHistory([]);
                  alert('√âl√®ve non trouv√©. V√©rifiez l\'orthographe de votre nom.');
                }
              } catch (error) {
                alert('Erreur lors de la recherche');
              }
            };

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">üîç Rechercher Mon Score</h1>
                    <button
                      onClick={() => setCurrentView('student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ‚Üê Retour
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">
                      Entrez votre nom complet
                    </h2>
                    <div className="flex space-x-4">
                      <input
                        type="text"
                        value={searchName}
                        onChange={(e) => setSearchName(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && searchPlayer()}
                        className="flex-1 px-4 py-3 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none text-lg"
                        placeholder="Votre pr√©nom et nom..."
                      />
                      <button
                        onClick={searchPlayer}
                        className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-lg transition-colors font-bold"
                      >
                        üîç Rechercher
                      </button>
                    </div>
                  </div>

                  {foundPlayer && (
                    <div className="space-y-6">
                      <div className={`bg-gradient-to-r ${franchiseColors[foundPlayer.franchise]} p-6 rounded-xl franchise-card`}>
                        <div className="text-center">
                          <h2 className="text-3xl font-bold text-white mb-2">{foundPlayer.name}</h2>
                          <div className="text-xl text-white/90 mb-4 flex items-center justify-center space-x-3">
                            <span>Franchise:</span>
                            <div className="flex items-center space-x-2">
                              <span className={`franchise-avatar ${getFranchiseAvatar(foundPlayer.franchise).class}`}>
                                {getFranchiseAvatar(foundPlayer.franchise).emoji}
                              </span>
                              <span className="font-bold">{foundPlayer.franchise}</span>
                            </div>
                          </div>
                          <div className="mb-4">
                            <div className="inline-flex items-center space-x-2 bg-black/30 px-4 py-2 rounded-full">
                              <span className="text-3xl">{getBadge(foundPlayer.score).emoji}</span>
                              <span className={`text-xl font-bold ${getBadge(foundPlayer.score).color}`}>
                                {getBadge(foundPlayer.score).name}
                              </span>
                            </div>
                          </div>
                          <div className="text-5xl font-bold text-white">{foundPlayer.score} points</div>
                        </div>
                      </div>
{foundPlayer.badges && foundPlayer.badges.length > 0 && (
  <div className="mt-6 bg-white/10 backdrop-blur-sm rounded-xl p-6">
    <h4 className="text-2xl font-bold text-white mb-4 text-center">
      üèÖ Mes Badges ({foundPlayer.badges.length})
    </h4>
    <div className="flex flex-wrap gap-3 justify-center">
      {foundPlayer.badges.map((badge, index) => (
        <div key={index} className="bg-black/30 px-4 py-3 rounded-lg flex items-center gap-2 hover:bg-black/50 transition-colors">
          <span className="text-3xl">{badge.badge_emoji}</span>
          <div>
            <div className="text-white font-bold">{badge.badge_name}</div>
            <div className="text-yellow-300 text-xs">+{badge.points || 0} pts</div>
          </div>
        </div>
      ))}
    </div>
  </div>
)}
                      <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                        <h3 className="text-2xl font-bold text-white mb-6 text-center">
                          üìã Mon Historique
                        </h3>
                        <div className="space-y-3 max-h-96 overflow-y-auto">
                          {searchHistory.length > 0 ? (
                            searchHistory.map((entry, index) => (
                              <div key={index} className="bg-white/20 p-4 rounded-lg">
                                <div className="flex justify-between items-start">
                                  <div>
                                    <div className="font-semibold text-white">{entry.action}</div>
                                    <div className="text-sm text-white/80">{entry.timestamp}</div>
                                    {entry.teacher_name && entry.teacher_name !== 'Anonyme' && (
                                      <div className="text-xs text-white/60">Par: {entry.teacher_name}</div>
                                    )}
                                  </div>
                                  <div className="text-right">
                                    <div className={`text-lg font-bold ${entry.points > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                      {entry.points > 0 ? '+' : ''}{entry.points}
                                    </div>
                                    <div className="text-sm text-white/70">Total: {entry.new_total}</div>
                                  </div>
                                </div>
                              </div>
                            ))
                          ) : (
                            <p className="text-white/70 text-center">Aucun historique disponible</p>
                          )}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // PAGE CLASSEMENTS
          if (currentView === 'rankings') {
            const franchiseRankings = getFranchiseRankings();
            const playerRankings = getGeneralPlayerRankings();

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">üèÜ Classements</h1>
                    <button
                      onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ‚Üê Retour
                    </button>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        üèÜ Classement des Franchises
                      </h2>
                      <div className="space-y-4">
                        {franchiseRankings.map(({ franchise, score, rank }) => {
                          const avatar = getFranchiseAvatar(franchise);
                          return (
                            <div
                              key={franchise}
                              className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg flex justify-between items-center shadow-lg franchise-card`}
                            >
                              <div className="flex items-center space-x-3">
                                <span className="text-2xl font-bold text-white">#{rank}</span>
                                <span className={`franchise-avatar ${avatar.class}`}>
                                  {avatar.emoji}
                                </span>
                                <span className="text-xl font-semibold text-white">{franchise}</span>
                              </div>
                              <span className="text-2xl font-bold text-white">{score} pts</span>
                            </div>
                          );
                        })}
                      </div>
                    </div>

                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        üëë Classement G√©n√©ral
                      </h2>
                      <div className="space-y-2 max-h-96 overflow-y-auto">
                        {playerRankings.map((player, index) => {
                          const badge = getBadge(player.score);
                          return (
                            <div
                              key={player.name}
                              className={`bg-gradient-to-r ${franchiseColors[player.franchise]} p-3 rounded-lg flex justify-between items-center shadow-md`}
                            >
                              <div className="flex items-center space-x-3">
                                <span className="text-lg font-bold text-white">#{index + 1}</span>
                                <span className="text-2xl">{badge.emoji}</span>
                                <div>
                                  <span className="text-lg font-semibold text-white">{player.name}</span>
                                  <div className="text-sm text-white/80">{player.franchise}</div>
                                </div>
                              </div>
                              <span className="text-lg font-bold text-white">{player.score} pts</span>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // PAGE DES BADGES
          if (currentView === 'badges') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-7xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">üèÖ Collection de Badges</h1>
                    <button
                      onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ‚Üê Retour
                    </button>
                  </div>

                  {/* Badges Individuels */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">üë§ Badges Individuels</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                      {Object.values(individualBadges).map(badge => {
                        // Compter combien de joueurs ont ce badge
                        const playersWithBadge = Object.entries(playerBadges).filter(([player, badges]) =>
                          badges?.some(b => b.id === badge.id)
                        ).map(([player]) => player);

                        return (
                          <div key={badge.id} className={`rounded-lg p-4 border-2 ${getRarityColor(badge.rarity)}`}>
                            <div className="flex items-center space-x-3 mb-3">
                              <span className="text-4xl">{badge.emoji}</span>
                              <div className="flex-1">
                                <h3 className="text-white font-bold text-lg">{badge.name}</h3>
                                <p className="text-white/70 text-sm">{badge.description}</p>
                                <p className="text-yellow-300 text-xs mt-1">+{badge.points} pts</p>
                              </div>
                            </div>
                            {playersWithBadge.length > 0 && (
                              <div className="text-white/60 text-xs mt-2 pt-2 border-t border-white/20">
                                <p>Obtenu par: {playersWithBadge.length} joueur(s)</p>
                                <p className="truncate">{playersWithBadge.slice(0, 3).join(', ')}{playersWithBadge.length > 3 ? '...' : ''}</p>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Badges Collectifs */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">üè† Badges Collectifs</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                      {Object.values(collectiveBadges).map(badge => {
                        // Compter combien de franchises ont ce badge
                        const franchisesWithBadge = Object.entries(franchiseBadges).filter(([franchise, badges]) =>
                          badges?.some(b => b.id === badge.id)
                        ).map(([franchise]) => franchise);

                        return (
                          <div key={badge.id} className={`rounded-lg p-4 border-2 ${getRarityColor(badge.rarity)}`}>
                            <div className="flex items-center space-x-3 mb-3">
                              <span className="text-4xl">{badge.emoji}</span>
                              <div className="flex-1">
                                <h3 className="text-white font-bold text-lg">{badge.name}</h3>
                                <p className="text-white/70 text-sm">{badge.description}</p>
                                <p className="text-yellow-300 text-xs mt-1">+{badge.points} pts franchise</p>
                              </div>
                            </div>
                            {franchisesWithBadge.length > 0 && (
                              <div className="text-white/60 text-xs mt-2 pt-2 border-t border-white/20">
                                <p>Obtenu par: {franchisesWithBadge.join(', ')}</p>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }
// PAGE DES GRADES
if (currentView === 'grades') {
  // D√©finition compl√®te de tous les grades
  const allGrades = [
    // GRADES N√âGATIFS
    { emoji: 'üóëÔ∏è', name: 'Scrub', minScore: -1000, maxScore: -50, color: 'from-red-900 to-red-700', description: 'Le pire niveau possible' },
    { emoji: 'ü™ë', name: 'Benchwarmer', minScore: -50, maxScore: -25, color: 'from-red-700 to-red-500', description: 'Clou√© sur le banc' },
    { emoji: 'üìâ', name: 'Plot', minScore: -25, maxScore: 0, color: 'from-gray-700 to-gray-500', description: 'Personnage sans importance' },
    
    // GRADES D√âBUTANTS
    { emoji: 'üë∂', name: 'Freshman', minScore: 0, maxScore: 10, color: 'from-yellow-600 to-yellow-500', description: 'Premi√®re ann√©e, apprend les bases' },
    { emoji: 'üèÄ', name: 'Rookie', minScore: 10, maxScore: 25, color: 'from-amber-600 to-amber-500', description: 'D√©butant prometteur' },
    
    // GRADES D√âVELOPPEMENT
    { emoji: 'üèÉ', name: 'Sixth Man', minScore: 25, maxScore: 50, color: 'from-green-700 to-green-600', description: 'Premier rempla√ßant de qualit√©' },
    { emoji: '‚≠ê', name: 'Starting Five', minScore: 50, maxScore: 75, color: 'from-green-600 to-green-500', description: 'Titulaire indiscutable' },
    
    // GRADES CONFIRM√âS
    { emoji: 'üíé', name: 'Franchise Player', minScore: 75, maxScore: 100, color: 'from-blue-700 to-blue-600', description: 'Pilier de l\'√©quipe' },
    { emoji: 'üåü', name: 'All-Star', minScore: 100, maxScore: 150, color: 'from-blue-600 to-blue-500', description: 'S√©lectionn√© parmi l\'√©lite' },
    
    // GRADES √âLITE
    { emoji: 'üî•', name: 'Superstar', minScore: 150, maxScore: 200, color: 'from-orange-600 to-red-500', description: 'Ph√©nom√®ne basketball' },
    { emoji: 'üèõÔ∏è', name: 'Hall of Fame', minScore: 200, maxScore: 250, color: 'from-yellow-600 to-yellow-500', description: 'L√©gende du sport' },
    
    // GRADE ULTIME
    { emoji: 'üêê', name: 'GOAT', minScore: 250, maxScore: 9999, color: 'from-purple-600 to-pink-600', description: 'Greatest Of All Time' }
  ];

  // Compter combien d'√©l√®ves ont chaque grade
  const getPlayersInGrade = (minScore, maxScore) => {
    return players.filter(p => p.score >= minScore && p.score < maxScore).length;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
      <div className="max-w-7xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-4xl font-bold text-white">üèÄ Syst√®me de Grades Basketball</h1>
          <button
            onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
            className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
          >
            ‚Üê Retour
          </button>
        </div>

        {/* Progression visuelle */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
          <h2 className="text-2xl font-bold text-white mb-6 text-center">üéØ √âchelle de Progression</h2>
          <div className="relative">
            {/* Barre de progression */}
            <div className="absolute left-0 right-0 top-1/2 h-2 bg-white/20 rounded-full transform -translate-y-1/2"></div>
            
            {/* Points cl√©s */}
            <div className="relative flex justify-between mb-8">
              <div className="text-center">
                <div className="w-4 h-4 bg-red-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">-50</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-yellow-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">0</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-green-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">50</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-blue-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">100</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-orange-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">150</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-purple-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">250+</div>
              </div>
            </div>
          </div>
        </div>

        {/* Liste des grades */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {allGrades.map((grade, index) => {
            const playersCount = getPlayersInGrade(grade.minScore, grade.maxScore);
            const isNegative = grade.minScore < 0;
            
            return (
              <div 
                key={index} 
                className={`bg-gradient-to-r ${grade.color} p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300`}
              >
                <div className="text-center">
                  <div className="text-6xl mb-3">{grade.emoji}</div>
                  <h3 className="text-2xl font-bold text-white mb-2">{grade.name}</h3>
                  <p className="text-white/90 mb-3">{grade.description}</p>
                  
                  <div className="bg-black/30 rounded-lg p-3 mb-3">
                    <div className="text-white font-bold">
                      {grade.maxScore === 9999 ? 
                        `${grade.minScore}+ points` : 
                        `${grade.minScore} √† ${grade.maxScore} points`
                      }
                    </div>
                  </div>
                  
                  {userType === 'teacher' && (
                    <div className="text-white/80 text-sm">
                      {playersCount > 0 ? (
                        <span className="font-bold">{playersCount} √©l√®ve{playersCount > 1 ? 's' : ''}</span>
                      ) : (
                        <span className="text-white/50">Aucun √©l√®ve</span>
                      )}
                    </div>
                  )}
                  
                  {isNegative && (
                    <div className="mt-2 text-red-200 text-xs">
                      ‚ö†Ô∏è Zone de danger
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>

        {/* Statistiques pour les profs */}
        {userType === 'teacher' && (
          <div className="mt-8 bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h3 className="text-2xl font-bold text-white mb-4">üìä R√©partition Actuelle</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="text-center">
                <div className="text-3xl font-bold text-red-400">
                  {players.filter(p => p.score < 0).length}
                </div>
                <div className="text-white/70">En difficult√©</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-yellow-400">
                  {players.filter(p => p.score >= 0 && p.score < 50).length}
                </div>
                <div className="text-white/70">D√©butants</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-green-400">
                  {players.filter(p => p.score >= 50 && p.score < 150).length}
                </div>
                <div className="text-white/70">Confirm√©s</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-purple-400">
                  {players.filter(p => p.score >= 150).length}
                </div>
                <div className="text-white/70">√âlite</div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
          // Return principal avec le modal d'historique et notifications
          return (
            <>
              {/* Syst√®me de notifications */}
              <NotificationSystem notifications={notifications} />
              
              {selectedPlayerHistory && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-xl p-6 max-w-md w-full max-h-96 overflow-y-auto">
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-xl font-bold">Historique de {selectedPlayerHistory}</h3>
                      <button
                        onClick={() => setSelectedPlayerHistory(null)}
                        className="text-gray-500 hover:text-gray-700 text-xl"
                      >
                        √ó
                      </button>
                    </div>
                    <div className="space-y-2">
                      {playerHistory.length > 0 ? (
                        playerHistory.map((entry, index) => (
                          <div key={index} className="border-l-4 border-blue-500 pl-3 py-2">
                            <div className="font-semibold">{entry.action}</div>
                            <div className="text-sm text-gray-600">
                              {entry.points > 0 ? '+' : ''}{entry.points} points
                            </div>
                            <div className="text-xs text-gray-500">
                              {entry.timestamp} ‚Ä¢ Total: {entry.new_total} pts
                              {entry.teacher_name && entry.teacher_name !== 'Anonyme' && (
                                <span> ‚Ä¢ Par: {entry.teacher_name}</span>
                              )}
                            </div>
                          </div>
                        ))
                      ) : (
                        <p className="text-gray-500 text-center">Aucun historique disponible</p>
                      )}
                    </div>
                  </div>
                </div>
              )}
            </>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
