<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GP Basketball Manager</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* === AVATARS ANIMÉS DES FRANCHISES === */

        /* Minotaurs - Taureau qui charge */
        .minotaur-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: charge 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.5));
        }

        @keyframes charge {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            50% { transform: translateX(-3px) rotate(-2deg); }
        }

        /* Krakens - Tentacules qui ondulent */
        .kraken-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: tentacles 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 100, 255, 0.5));
        }

        @keyframes tentacles {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(2deg) scale(1.05); }
            66% { transform: rotate(-2deg) scale(0.95); }
        }

        /* Phoenix - Flammes qui dansent */
        .phoenix-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: flames 2s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(255, 165, 0, 0.7));
        }

        @keyframes flames {
            0%, 100% { transform: translateY(0px) scale(1); }
            25% { transform: translateY(-2px) scale(1.1); }
            75% { transform: translateY(1px) scale(0.9); }
        }

        /* Werewolves - Yeux qui brillent */
        .werewolf-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: glow 4s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.4));
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.4)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 255, 0, 0.8)) brightness(1.2); }
        }

        /* Effet de hover pour tous les avatars */
        .franchise-avatar:hover {
            transform: scale(1.2);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        /* Particules de fond optionnelles */
        .franchise-card {
            position: relative;
            overflow: hidden;
        }

        .franchise-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: sparkle 10s linear infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-20px, -20px) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Définition des badges individuels
        // Remplacez les définitions de badges dans le frontend par celles-ci :
const individualBadges = {
  // === SÉRIES (4 badges) ===
  hot_streak: {
    id: 'hot_streak',
    name: 'Hot Streak',
    emoji: '🔥',
    description: '5 actions positives d\'affilée',
    points: 5,
    rarity: 'bronze'
  },
  tsunami: {
    id: 'tsunami',
    name: 'Tsunami',
    emoji: '🌊',
    description: '10 actions positives d\'affilée',
    points: 10,
    rarity: 'argent'
  },
  unstoppable: {
    id: 'unstoppable',
    name: 'Unstoppable',
    emoji: '🚀',
    description: '15 actions positives d\'affilée',
    points: 20,
    rarity: 'or'
  },
  on_fire: {
    id: 'on_fire',
    name: 'On Fire',
    emoji: '💪',
    description: '2 Hardworker en 2 semaines',
    points: 10,
    rarity: 'argent'
  },
  
  // === PERSÉVÉRANCE (2 badges) ===
  phoenix: {
    id: 'phoenix',
    name: 'Phoenix',
    emoji: '🦅',
    description: 'Remonter de -50 à +50 points',
    points: 20,
    rarity: 'or'
  },
  marathon_runner: {
    id: 'marathon_runner',
    name: 'Marathon Runner',
    emoji: '🏃',
    description: 'Actions positives 5 jours consécutifs',
    points: 5,
    rarity: 'bronze'
  },
  
  // === SOCIAUX/ÉQUIPE (3 badges) ===
  team_captain: {
    id: 'team_captain',
    name: 'Team Captain',
    emoji: '👑',
    description: 'Meilleur de sa franchise pendant 1 semaine',
    points: 10,
    rarity: 'argent'
  },
  veteran: {
    id: 'veteran',
    name: 'Veteran',
    emoji: '🎖️',
    description: 'Top 3 de sa franchise pendant 2 mois',
    points: 20,
    rarity: 'or'
  },
  team_player: {
    id: 'team_player',
    name: 'Team Player',
    emoji: '🤝',
    description: 'Sa franchise gagne le + de points en 1 semaine',
    points: 5,
    rarity: 'bronze'
  },
  
  // === SPÉCIAUX & RARES (3 badges) ===
  showtime: {
    id: 'showtime',
    name: 'Showtime',
    emoji: '🎪',
    description: 'Recevoir Félicitations 3 fois',
    points: 35,
    rarity: 'diamant'
  },
  halloween_spirit: {
    id: 'halloween_spirit',
    name: 'Halloween Spirit',
    emoji: '🎃',
    description: '3 Actions positives semaine Halloween',
    points: 50,
    rarity: 'legendaire'
  },
  christmas_magic: {
    id: 'christmas_magic',
    name: 'Christmas Magic',
    emoji: '🎄',
    description: 'Actions positives pendant les fêtes',
    points: 50,
    rarity: 'legendaire'
  }
};
       const collectiveBadges = {

  // === PERFORMANCES (4 badges) ===
  rocketLaunch: {
    id: 'rocket_launch',
    name: 'Rocket Launch',
    emoji: '🚀',
    description: '+80 points collectifs en 1 semaine',
    points: 20,
    rarity: 'bronze'
  },
  tidalWave: {
    id: 'tidal_wave',
    name: 'Tidal Wave',
    emoji: '🌊',
    description: '+200 points collectifs en 1 mois',
    points: 100,
    rarity: 'or'
  },
  lightningStrike: {
    id: 'lightning_strike',
    name: 'Lightning Strike',
    emoji: '⚡',
    description: 'Tous les membres gagnent points même jour',
    points: 20,
    rarity: 'bronze'
  },
  houseOnFire: {
    id: 'house_on_fire',
    name: 'House on Fire',
    emoji: '🔥',
    description: '80% membres actions positives en 1 semaine',
    points: 50,
    rarity: 'argent'
  },
  
  // === SOLIDARITÉ (4 badges) ===
  unitedWeStand: {
    id: 'united_we_stand',
    name: 'United We Stand',
    emoji: '🤝',
    description: 'Aucun membre négatif pendant 2 semaines',
    points: 50,
    rarity: 'argent'
  },
  perfectBalance: {
    id: 'perfect_balance',
    name: 'Perfect Balance',
    emoji: '⚖️',
    description: 'Tous membres entre 25-75 points',
    points: 100,
    rarity: 'or'
  },
  harmony: {
    id: 'harmony',
    name: 'Harmony',
    emoji: '🌈',
    description: 'Écart <50 points entre 1er et dernier',
    points: 50,
    rarity: 'argent'
  }
};

        // Fonction pour obtenir la couleur selon la rareté
        const getRarityColor = (rarity) => {
          switch(rarity) {
            case 'common': return 'border-gray-400';
            case 'rare': return 'border-blue-400';
            case 'epic': return 'border-purple-400';
            case 'legendary': return 'border-yellow-400';
            default: return 'border-gray-400';
          }
        };

        // Composant BadgeDisplay corrigé
const BadgeDisplay = ({ badges }) => {
  if (!badges || badges.length === 0) return null;
  
  return (
    <div className="flex flex-wrap gap-1 mt-2">
      {badges.map((badge, index) => {
        // Gérer les différents formats de badges
        const badgeId = badge.badge_id || badge.id;
        const badgeName = badge.badge_name || badge.name;
        const badgeEmoji = badge.badge_emoji || badge.emoji;
        const badgeDescription = badge.description || '';
        const badgePoints = badge.points || 0;
        
        return (
          <span 
            key={badgeId || index} 
            className="text-xl cursor-help" 
            title={`${badgeName} - ${badgeDescription} (+${badgePoints} pts)`}
          >
            {badgeEmoji || '🏅'}
          </span>
        );
      })}
    </div>
  );
};

        // Composant NotificationSystem
        const NotificationSystem = ({ notifications }) => {
          if (!notifications || notifications.length === 0) return null;
          
          return (
            <div className="fixed top-4 right-4 z-50 space-y-2 max-w-sm">
              {notifications.map((notif, index) => (
                <div
                  key={index}
                  className="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-2xl animate-pulse"
                >
                  {notif}
                </div>
              ))}
            </div>
          );
        };

        const App = () => {
          const [currentView, setCurrentView] = useState('home');
          const [userType, setUserType] = useState(null);
          const [players, setPlayers] = useState([]);
          const [expandedDropdown, setExpandedDropdown] = useState(null);
          const [selectedPlayerHistory, setSelectedPlayerHistory] = useState(null);
          const [playerHistory, setPlayerHistory] = useState([]);
          const [loading, setLoading] = useState(false);
          const [password, setPassword] = useState('');
          const [loginError, setLoginError] = useState('');
          const [teacherName, setTeacherName] = useState('');
          const [selectedStudent, setSelectedStudent] = useState('');
          const [newStudentName, setNewStudentName] = useState('');
          const [newStudentFranchise, setNewStudentFranchise] = useState('Minotaurs');
          const [searchName, setSearchName] = useState('');
          const [foundPlayer, setFoundPlayer] = useState(null);
          const [searchHistory, setSearchHistory] = useState([]);
          const [showEvolutionChart, setShowEvolutionChart] = useState(false);
          const [chartData, setChartData] = useState(null);
          const [chartType, setChartType] = useState('player');
          // États pour les badges
          const [playerBadges, setPlayerBadges] = useState({});
          const [franchiseBadges, setFranchiseBadges] = useState({});
          const [notifications, setNotifications] = useState([]);
          const [categoryStats, setCategoryStats] = useState([]);
          const [mvpData, setMvpData] = useState({ mvpAcademic: null, mvpSport: null });
          const [top5Data, setTop5Data] = useState({ academic: [], sport: [] });
          const [franchiseBalance, setFranchiseBalance] = useState([]);
          const [hallOfFameData, setHallOfFameData] = useState({});
          const [loadingStats, setLoadingStats] = useState(true);
 // Charger toutes les statistiques réelles
  useEffect(() => {
    const loadAllStats = async () => {
      try {
        setLoadingStats(true);
        
        // Charger toutes les données en parallèle
        const [
          categoryResponse,
          mvpResponse, 
          top5Response,
          franchiseResponse,
          hallOfFameResponse
        ] = await Promise.all([
          fetch('/api/stats/category-breakdown'),
          fetch('/api/stats/mvp-weekly'),
          fetch('/api/stats/top5-by-category'),
          fetch('/api/stats/franchise-balance'),
          fetch('/api/stats/hall-of-fame')
        ]);

        const categoryData = await categoryResponse.json();
        const mvpDataResponse = await mvpResponse.json();
        const top5DataResponse = await top5Response.json();
        const franchiseData = await franchiseResponse.json();
        const hallOfFameDataResponse = await hallOfFameResponse.json();

        setCategoryStats(categoryData);
        setMvpData(mvpDataResponse);
        setTop5Data(top5DataResponse);
        setFranchiseBalance(franchiseData);
        setHallOfFameData(hallOfFameDataResponse);
        
      } catch (error) {
        console.error('Erreur lors du chargement des statistiques:', error);
      } finally {
        setLoadingStats(false);
      }
    };

    loadAllStats();
  }, []);

  const franchiseRankings = getFranchiseRankings();
  const playerRankings = getGeneralPlayerRankings();

          
          // Fonction pour obtenir le grade basketball selon le score
          const getBadge = (score) => {
            // Grade Ultime
            if (score >= 250) return { 
              emoji: '🐐', 
              name: 'GOAT', 
              fullName: 'Greatest Of All Time',
              color: 'text-purple-300',
              bgColor: 'from-purple-600 to-purple-800',
              description: 'Le plus grand de tous les temps'
            };
            
            // Grades Elite
            if (score >= 200) return { 
              emoji: '🏛️', 
              name: 'Hall of Fame', 
              fullName: 'Hall of Fame',
              color: 'text-yellow-300',
              bgColor: 'from-yellow-500 to-yellow-700',
              description: 'Légende du sport'
            };
            if (score >= 150) return { 
              emoji: '🔥', 
              name: 'Superstar', 
              fullName: 'Superstar',
              color: 'text-orange-300',
              bgColor: 'from-orange-500 to-red-600',
              description: 'Phénomène basketball'
            };
            
            // Grades Confirmés
            if (score >= 100) return { 
              emoji: '🌟', 
              name: 'All-Star', 
              fullName: 'All-Star',
              color: 'text-blue-300',
              bgColor: 'from-blue-500 to-blue-700',
              description: 'Sélectionné parmi l\'élite'
            };
            if (score >= 75) return { 
              emoji: '💎', 
              name: 'Franchise Player', 
              fullName: 'Franchise Player',
              color: 'text-cyan-300',
              bgColor: 'from-cyan-500 to-blue-600',
              description: 'Pilier de l\'équipe'
            };
            
            // Grades Développement
            if (score >= 50) return { 
              emoji: '⭐', 
              name: 'Starting Five', 
              fullName: 'Starting Five',
              color: 'text-green-300',
              bgColor: 'from-green-500 to-green-700',
              description: 'Titulaire indiscutable'
            };
            if (score >= 25) return { 
              emoji: '🏃', 
              name: 'Sixth Man', 
              fullName: 'Sixth Man',
              color: 'text-emerald-300',
              bgColor: 'from-emerald-500 to-green-600',
              description: 'Premier remplaçant de qualité'
            };
            
            // Grades Débutants
            if (score >= 10) return { 
              emoji: '🏀', 
              name: 'Rookie', 
              fullName: 'Rookie',
              color: 'text-amber-300',
              bgColor: 'from-amber-500 to-orange-500',
              description: 'Débutant prometteur'
            };
            if (score >= 0) return { 
              emoji: '👶', 
              name: 'Freshman', 
              fullName: 'Freshman',
              color: 'text-yellow-300',
              bgColor: 'from-yellow-400 to-amber-500',
              description: 'Première année, apprend les bases'
            };
            
            // Grades Négatifs
            if (score >= -25) return { 
              emoji: '📉', 
              name: 'Plot', 
              fullName: 'Plot',
              color: 'text-gray-400',
              bgColor: 'from-gray-500 to-gray-700',
              description: 'Personnage sans importance'
            };
            if (score >= -50) return { 
              emoji: '🪑', 
              name: 'Benchwarmer', 
              fullName: 'Benchwarmer',
              color: 'text-red-400',
              bgColor: 'from-red-500 to-red-700',
              description: 'Cloué sur le banc'
            };
            
            // Pire niveau
            return { 
              emoji: '🗑️', 
              name: 'Scrub', 
              fullName: 'Scrub',
              color: 'text-red-600',
              bgColor: 'from-red-700 to-red-900',
              description: 'Le pire niveau possible'
            };
          };

          // Fonction pour obtenir l'avatar animé de la franchise
          const getFranchiseAvatar = (franchise) => {
            const avatars = {
              Minotaurs: { emoji: '🐂', class: 'minotaur-avatar', name: 'Taureau Enragé' },
              Krakens: { emoji: '🐙', class: 'kraken-avatar', name: 'Kraken des Profondeurs' },
              Phoenix: { emoji: '🔥', class: 'phoenix-avatar', name: 'Phoenix Éternel' },
              Werewolves: { emoji: '🐺', class: 'werewolf-avatar', name: 'Loup-Garou' }
            };
            return avatars[franchise] || { emoji: '⚡', class: 'franchise-avatar', name: 'Guerrier' };
          };

          // Actions positives et négatives
          const positiveActions = [
  // ====== CATÉGORIE SPORT ====== 
  { label: '🏀 Hardworker', points: 6, category: 'sport' },
  { label: '🏀 Bon entrainement club', points: 4, category: 'sport' },
  { label: '🏆 Victoire weekend (Région/France)', points: 6, category: 'sport' },
  { label: '🥈 Défaite weekend (Région/France)', points: 2, category: 'sport' },
  { label: '🏅 Victoire weekend (Département)', points: 4, category: 'sport' },
  { label: '🎯 Défaite weekend (Département)', points: 1, category: 'sport' },
  { label: '⭐ Extra basket (cross, AS...) - Excellent', points: 10, category: 'sport' },
  { label: '⭐ Extra basket (cross, AS...) - Très bien', points: 6, category: 'sport' },
  { label: '⭐ Extra basket (cross, AS...) - Bien', points: 3, category: 'sport' },
  { label: '🎖️ Parcours sélection', points: 10, category: 'sport' },
  { label: '🌟 Tournoi des étoiles', points: 25, category: 'sport' },
  { label: '💪 Entrainements facultatifs', points: 3, category: 'sport' },
  { label: '📊 Table de marque/Arbitrage weekend', points: 5, category: 'sport' },
  
  // ====== CATÉGORIE ACADÉMIQUE ======
  { label: '📚 Observation positive', points: 5, category: 'academic' },
  { label: '📚 Participation active en classe', points: 4, category: 'academic' },
  { label: '📚 Travail de qualité (oral/écrit)', points: 4, category: 'academic' },
  { label: '📚 Activités facultatives (sentinelle)', points: 5, category: 'academic' },
  { label: '📚 Activités facultatives (ateliers devoirs)', points: 4, category: 'academic' },
  { label: '📚 Activités facultatives (délégué)', points: 6, category: 'academic' },
  { label: '📚 Activités facultatives (conseil admin)', points: 8, category: 'academic' },
  { label: '🏆 Félicitations', points: 25, category: 'academic' },
  { label: '🎖️ Compliments', points: 15, category: 'academic' },
  { label: '👍 Encouragements', points: 10, category: 'academic' },
  
  // === BONUS FLEXIBLES ===
  { label: 'Bonus Sport', points: 2, category: 'sport' },
  { label: 'Bonus Scolaire', points: 2, category: 'academic' },
  { label: 'Bonus Sport', points: 3, category: 'sport' },
  { label: 'Bonus Scolaire', points: 3, category: 'academic' },
  { label: 'Bonus Sport', points: 5, category: 'sport' },
  { label: 'Bonus Scolaire', points: 5, category: 'academic' },
  { label: 'Bonus Sport', points: 10, category: 'sport' },
  { label: 'Bonus Scolaire', points: 10, category: 'academic' }
];
          
              const negativeActions = [
  // ====== CATÉGORIE SPORT ====== 
  { label: 'Mauvaise attitude/retard entrainement', points: -4, category: 'sport' },
  { label: 'Absences répétées/non justifiées club', points: -4, category: 'sport' },
  
  // ====== CATÉGORIE ACADÉMIQUE ======
  { label: 'Observation négative', points: -5, category: 'academic' },
  { label: 'Exclusion de cours', points: -8, category: 'academic' },
  { label: 'Exclusion temporaire établissement', points: -15, category: 'academic' },
  { label: 'Travail non fait', points: -3, category: 'academic' },
  { label: 'Retard/absence non justifiée', points: -3, category: 'academic' },
  { label: 'Mauvaise attitude en classe (perturbe)', points: -5, category: 'academic' },
  
  // === PÉNALITÉS FLEXIBLES ===
  { label: 'Pénalité Sport', points: -2, category: 'sport' },
  { label: 'Pénalité Scolaire', points: -2, category: 'academic' },
  { label: 'Pénalité Sport', points: -3, category: 'sport' },
  { label: 'Pénalité Scolaire', points: -3, category: 'academic' },
  { label: 'Pénalité Sport', points: -5, category: 'sport' },
  { label: 'Pénalité Scolaire', points: -5, category: 'academic' }
];

          // Couleurs des franchises
          const franchiseColors = {
            Minotaurs: 'from-red-600 to-red-800',
            Krakens: 'from-blue-600 to-blue-800',
            Phoenix: 'from-orange-600 to-orange-800',
            Werewolves: 'from-green-600 to-green-800'
          };

          // Vérifier le mot de passe professeur
          const verifyTeacher = async () => {
            if (!password.trim()) {
              setLoginError('Veuillez entrer un mot de passe');
              return;
            }
            
            try {
              const response = await fetch('/api/verify-teacher', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
              });
              
              const data = await response.json();
              if (data.success) {
                setUserType('teacher');
                setCurrentView('teacher-dashboard');
                setLoginError('');
              } else {
                setLoginError('Mot de passe incorrect');
              }
            } catch (error) {
              setLoginError('Erreur de connexion');
            }
          };

          // Charger les joueurs
          const loadPlayers = async () => {
            try {
              const response = await fetch('/api/players');
              const data = await response.json();
              setPlayers(data);
            } catch (error) {
              console.error('Erreur lors du chargement des joueurs:', error);
            }
          };

          // Ajouter des points (professeurs uniquement)
          const addPoints = async (playerName, points, action) => {
            setLoading(true);
            try {
              const response = await fetch('/api/add-points', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ playerName, points, action, teacherName })
              });
              
              if (response.ok) {
                await loadPlayers();
                setExpandedDropdown(null);
              }
            } catch (error) {
              console.error('Erreur lors de l\'ajout de points:', error);
            }
            setLoading(false);
          };

          // Charger l'historique d'un joueur
          const loadPlayerHistory = async (playerName) => {
            try {
              const response = await fetch(`/api/history/${encodeURIComponent(playerName)}`);
              const data = await response.json();
              setPlayerHistory(data);
              setSelectedPlayerHistory(playerName);
            } catch (error) {
              console.error('Erreur lors du chargement de l\'historique:', error);
            }
          };

          // Annuler la dernière action (professeurs uniquement)
          const undoLastAction = async (playerName) => {
            setLoading(true);
            try {
              const response = await fetch(`/api/undo-last/${encodeURIComponent(playerName)}`, {
                method: 'DELETE',
              });
              
              if (response.ok) {
                await loadPlayers();
              }
            } catch (error) {
              console.error('Erreur lors de l\'annulation:', error);
            }
            setLoading(false);
          };

          // Ajouter un élève (professeurs uniquement)
          const addStudent = async () => {
            if (!newStudentName.trim()) {
              alert('Veuillez entrer un nom');
              return;
            }
            
            try {
              const response = await fetch('/api/add-student', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                  name: newStudentName.trim(), 
                  franchise: newStudentFranchise 
                })
              });
              
              if (response.ok) {
                setNewStudentName('');
                await loadPlayers();
                alert('Élève ajouté avec succès !');
              } else {
                const error = await response.json();
                alert(error.error || 'Erreur lors de l\'ajout');
              }
            } catch (error) {
              alert('Erreur lors de l\'ajout de l\'élève');
            }
          };

          // Supprimer un élève (professeurs uniquement)
          const removeStudent = async (playerName) => {
            if (!confirm(`Êtes-vous sûr de vouloir supprimer ${playerName} ? Cette action est irréversible.`)) {
              return;
            }
            
            try {
              const response = await fetch(`/api/remove-student/${encodeURIComponent(playerName)}`, {
                method: 'DELETE'
              });
              
              if (response.ok) {
                await loadPlayers();
                alert('Élève supprimé avec succès');
              }
            } catch (error) {
              alert('Erreur lors de la suppression');
            }
          };

          useEffect(() => {
            if (userType) {
              loadPlayers();
              const interval = setInterval(loadPlayers, 10000);
              return () => clearInterval(interval);
            }
          }, [userType]);

          // Obtenir les joueurs triés par score pour une franchise
          const getSortedPlayers = (franchise) => {
            return players
              .filter(player => player.franchise === franchise)
              .sort((a, b) => b.score - a.score);
          };

          // Obtenir le classement des franchises
          const getFranchiseRankings = () => {
            const franchiseScores = {};
            ['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].forEach(franchise => {
              franchiseScores[franchise] = players
                .filter(player => player.franchise === franchise)
                .reduce((total, player) => total + player.score, 0);
            });
            
            return Object.entries(franchiseScores)
              .sort(([,a], [,b]) => b - a)
              .map(([franchise, score], index) => ({ franchise, score, rank: index + 1 }));
          };

          // Obtenir le classement général des joueurs
          const getGeneralPlayerRankings = () => {
            return [...players].sort((a, b) => b.score - a.score);
          };

          // PAGE D'ACCUEIL - CHOIX DU TYPE D'UTILISATEUR
          // Page d'accueil avec logo - remplace votre condition if (currentView === 'home')
if (currentView === 'home') {
  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 relative overflow-hidden">
      {/* Particules simplifiées pour mobile */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        {[...Array(20)].map((_, i) => (
          <div
            key={i}
            className="absolute bg-white/5 rounded-full animate-pulse"
            style={{
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              width: `${Math.random() * 4 + 1}px`,
              height: `${Math.random() * 4 + 1}px`,
              animationDelay: `${Math.random() * 3}s`,
              animationDuration: `${Math.random() * 2 + 3}s`
            }}
          />
        ))}
      </div>

      {/* Container principal */}
      <div className="px-4 py-6 md:px-8 md:py-8 relative z-10">
        <div className="max-w-4xl mx-auto">
          
          {/* Logo centré */}
          <div className="text-center mb-8">
            <div className="inline-block mb-6">
              <img 
                src="/gp-basketball.png"
                alt="Gerard Philipe Basketball" 
                className="w-32 h-32 md:w-48 md:h-48 lg:w-56 lg:h-56 mx-auto drop-shadow-2xl hover:scale-105 transition-transform duration-300"
              />
            </div>
            
            {/* No Pain No Gain - Citation principale */}
            <div className="mb-6">
              <h1 className="text-4xl md:text-6xl lg:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 via-pink-500 to-orange-600 mb-2 tracking-tight">
                "NO PAIN NO GAIN"
              </h1>
               <p className="text-lg md:text-xl text-white/90 font-semibold">
                Année 2025/2026
              </p>
            </div>
            
            {/* Citation du jour */}
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-8 border border-white/20">
              <p className="text-sm text-orange-300 font-semibold mb-1">Citation du jour</p>
              <p className="text-white text-base md:text-lg italic">
                {(() => {
                  const quotes = [
                    "Hard work beats talent when talent refuses to work hard.",
                    "Every practice is a chance to get closer to your best self.",
                    "Success looks easy on game day, but it's built behind closed doors in sweat and silence.",
                    "Discipline is choosing what you want most, over what you want now.",
                    "Greatness is never given, it's earned in hours nobody sees.",
                    "Stay humble in victory, stay hungry in defeat.",
                    "The scoreboard doesn't lie, but neither does the effort you gave to get there.",
                    "Respect the game, respect your opponents, but never stop believing in your own grind.",
                    "Confidence comes from preparation, not from talking.",
                    "The best players never act like they're bigger than the team.",
                    "Champions are built from resilience, not comfort.",
                    "Failing is part of learning; quitting is not an option.",
                    "Pain is temporary, but quitting lasts forever.",
                    "Pressure is a privilege — it means you've earned the right to compete.",
                    "If you fall ten times, stand up eleven.",
                    "Don't chase trophies, chase growth — the trophies will follow.",
                    "Dreams don't come true without sweat as their foundation.",
                    "Your body is pulled by fatigue, but your mind decides the limit.",
                    "Leaders aren't born in the spotlight, they are forged in the unseen grind.",
                    "Believe in the work you've put in — the results will eventually speak for you."
                  ];
                  const today = new Date().getDate();
                  return quotes[today % quotes.length];
                })()}
              </p>
            </div>
            
{/* Sous-titre explicatif */}
            <p className="text-base md:text-lg text-purple-200 mb-8 max-w-2xl mx-auto">
              section sportive basketball
            </p>
          </div>

          {/* Boutons d'accès redesignés avec glassmorphism */}
          <div className="space-y-4 md:grid md:grid-cols-2 md:gap-6 md:space-y-0 max-w-3xl mx-auto">
            
            {/* Bouton Professeur */}
            <button
              onClick={() => setCurrentView('teacher-login')}
              className="w-full group relative overflow-hidden backdrop-blur-md bg-white/10 border border-white/20 hover:bg-white/15 active:bg-white/20 text-white rounded-2xl shadow-2xl transform active:scale-95 md:hover:scale-105 transition-all duration-300 touch-manipulation"
            >
              <div className="absolute inset-0 bg-gradient-to-r from-emerald-500/20 to-emerald-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              <div className="relative z-10 p-6 md:p-8">
                <div className="flex items-center space-x-4 md:flex-col md:space-x-0 md:space-y-4">
                  <div className="text-4xl md:text-6xl flex-shrink-0 group-hover:scale-110 transition-transform duration-300">👨‍🏫</div>
                  <div className="text-left md:text-center">
                    <h2 className="text-xl md:text-3xl font-bold mb-2 text-emerald-200">PROFESSEUR</h2>
                    <p className="text-white/80 text-sm md:text-base mb-3">Gestion complète du système</p>
                    <div className="inline-flex items-center bg-emerald-900/40 backdrop-blur-sm px-4 py-2 rounded-full border border-emerald-500/30">
                      <span className="text-xs md:text-sm text-emerald-300 font-semibold">🔐 Accès sécurisé</span>
                    </div>
                  </div>
                </div>
              </div>
            </button>
            
            {/* Bouton Élève */}
            <button
              onClick={() => {
                setUserType('student');
                setCurrentView('student-dashboard');
              }}
              className="w-full group relative overflow-hidden backdrop-blur-md bg-white/10 border border-white/20 hover:bg-white/15 active:bg-white/20 text-white rounded-2xl shadow-2xl transform active:scale-95 md:hover:scale-105 transition-all duration-300 touch-manipulation"
            >
              <div className="absolute inset-0 bg-gradient-to-r from-orange-500/20 to-pink-500/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              <div className="relative z-10 p-6 md:p-8">
                <div className="flex items-center space-x-4 md:flex-col md:space-x-0 md:space-y-4">
                  <div className="text-4xl md:text-6xl flex-shrink-0 group-hover:scale-110 transition-transform duration-300">👨‍🎓</div>
                  <div className="text-left md:text-center">
                    <h2 className="text-xl md:text-3xl font-bold mb-2 text-orange-200">ÉLÈVE</h2>
                    <p className="text-white/80 text-sm md:text-base mb-3">Consultez vos performances</p>
                    <div className="inline-flex items-center bg-orange-900/40 backdrop-blur-sm px-4 py-2 rounded-full border border-orange-500/30">
                      <span className="text-xs md:text-sm text-orange-300 font-semibold">👁️ Accès libre</span>
                    </div>
                  </div>
                </div>
              </div>
            </button>
            
          </div>

          {/* Footer discret */}
          <div className="mt-12 text-center">
            <div className="inline-flex items-center bg-white/5 backdrop-blur-sm rounded-full px-4 py-2 border border-white/10">
              <span className="text-white/60 text-xs">
                Mis à jour: {new Date().toLocaleDateString('fr-FR')} • Gérard Philipe Basketball
              </span>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  );
}

          // PAGE DE CONNEXION PROFESSEUR
          if (currentView === 'teacher-login') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8 flex items-center justify-center">
                <div className="bg-white/10 backdrop-blur-sm rounded-xl p-8 max-w-md w-full">
                  <h2 className="text-3xl font-bold text-white text-center mb-8">
                    🔐 Connexion Professeur
                  </h2>
                  
                  <div className="space-y-6">
                    <div>
                      <label className="block text-white text-sm font-bold mb-2">
                        Nom (optionnel)
                      </label>
                      <input
                        type="text"
                        value={teacherName}
                        onChange={(e) => setTeacherName(e.target.value)}
                        className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                        placeholder="Votre nom..."
                      />
                    </div>
                    
                    <div>
                      <label className="block text-white text-sm font-bold mb-2">
                        Mot de passe *
                      </label>
                      <input
                        type="password"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && verifyTeacher()}
                        className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                        placeholder="Mot de passe..."
                      />
                    </div>
                    
                    {loginError && (
                      <div className="text-red-300 text-sm text-center">
                        {loginError}
                      </div>
                    )}
                    
                    <div className="flex space-x-4">
                      <button
                        onClick={() => setCurrentView('home')}
                        className="flex-1 bg-gray-600 hover:bg-gray-500 text-white py-3 rounded-lg transition-colors"
                      >
                        ← Retour
                      </button>
                      <button
                        onClick={verifyTeacher}
                        className="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white py-3 rounded-lg transition-colors"
                      >
                        Se connecter
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // TABLEAU DE BORD PROFESSEUR
          if (currentView === 'teacher-dashboard') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">
                      👨‍🏫 Tableau de Bord Professeur
                      {teacherName && <span className="text-2xl text-purple-200"> - {teacherName}</span>}
                    </h1>
                    <button
                      onClick={() => {
                        setCurrentView('home');
                        setUserType(null);
                        setPassword('');
                        setTeacherName('');
                      }}
                      className="bg-red-600 hover:bg-red-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      🚪 Déconnexion
                    </button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <button
                      onClick={() => setCurrentView('teacher-players')}
                      className="bg-gradient-to-r from-emerald-600 to-emerald-800 hover:from-emerald-500 hover:to-emerald-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">👥</div>
                      <h3 className="text-xl font-bold">Gestion des Points</h3>
                      <p className="text-emerald-100 text-sm">Ajouter/retirer des points</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('teacher-admin')}
                      className="bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">⚙️</div>
                      <h3 className="text-xl font-bold">Administration</h3>
                      <p className="text-blue-100 text-sm">Gérer les élèves</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('rankings')}
                      className="bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">🏆</div>
                      <h3 className="text-xl font-bold">Classements</h3>
                      <p className="text-amber-100 text-sm">Voir les résultats</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('badges')}
                      className="bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">🏅</div>
                      <h3 className="text-xl font-bold">Badges</h3>
                      <p className="text-purple-100 text-sm">Voir tous les badges</p>
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h3 className="text-2xl font-bold text-white mb-4">📊 Statistiques Rapides</h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const franchisePlayers = getSortedPlayers(franchise);
                        const totalPoints = franchisePlayers.reduce((sum, player) => sum + player.score, 0);
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg text-center franchise-card`}>
                            <div className="flex items-center justify-center mb-2">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                            </div>
                            <h4 className="font-bold text-white">{franchise}</h4>
                            <div className="text-2xl font-bold text-white">{totalPoints}</div>
                            <div className="text-sm text-white/80">{franchisePlayers.length} élèves</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // GESTION DES POINTS PROFESSEUR
          if (currentView === 'teacher-players') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4 md:p-8">
                <div className="max-w-7xl mx-auto">
                  <div className="flex justify-between items-center mb-6">
                    <h1 className="text-2xl md:text-4xl font-bold text-white">👥 Gestion des Points</h1>
                    <div className="flex space-x-2 md:space-x-4">
                      {loading && <div className="text-white text-sm md:text-base">⏳ Chargement...</div>}
                      <button
                        onClick={() => setCurrentView('teacher-dashboard')}
                        className="bg-gray-600 hover:bg-gray-500 text-white px-3 md:px-6 py-2 md:py-3 rounded-lg transition-colors text-sm md:text-base"
                      >
                        ← Retour
                      </button>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                    {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                      const avatar = getFranchiseAvatar(franchise);
                      return (
                        <div key={franchise} className="bg-white/10 backdrop-blur-sm rounded-xl p-4 md:p-6 franchise-card">
                          <h2 className={`text-lg md:text-2xl font-bold text-white mb-4 text-center bg-gradient-to-r ${franchiseColors[franchise]} p-2 md:p-3 rounded-lg flex items-center justify-center space-x-2`}>
                            <span className={`franchise-avatar ${avatar.class} text-2xl md:text-3xl`}>
                              {avatar.emoji}
                            </span>
                            <span className="text-sm md:text-base">{franchise}</span>
                          </h2>
                          <div className="space-y-3">
                            {getSortedPlayers(franchise).map(player => (
                              <div key={player.name} className="bg-white/20 rounded-lg p-3">
                                <div className="flex justify-between items-center mb-2">
                                  <button
                                    onClick={() => loadPlayerHistory(player.name)}
                                    className="text-white font-semibold hover:text-yellow-300 transition-colors flex items-center space-x-1 text-sm md:text-base"
                                  >
                                    <span className="truncate max-w-24 md:max-w-none">{player.name}</span>
                                    <span>📋</span>
                                  </button>
                                  <div className="flex items-center space-x-2">
                                    <div className="flex items-center space-x-1">
                                      <span className="text-xl md:text-2xl">
                                        {getBadge(player.score).emoji}
                                      </span>
                                      <span className="text-white font-bold text-sm md:text-base">
                                        {player.score}
                                      </span>
                                    </div>
                                    <button
                                      onClick={() => undoLastAction(player.name)}
                                      className="bg-red-500 hover:bg-red-400 text-white px-2 py-1 rounded text-xs"
                                      title="Annuler dernière action"
                                    >
                                      ↺
                                    </button>
                                  </div>
                                </div>
                                <BadgeDisplay badges={player.badges || []} />
                                <button
                                  onClick={() => {
                                    setSelectedStudent(player.name);
                                    setCurrentView('teacher-actions');
                                  }}
                                  className="w-full bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded transition-colors font-semibold text-sm md:text-base"
                                  disabled={loading}
                                >
                                  Attribuer des Points
                                </button>
                              </div>
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          }

          // PAGE D'ATTRIBUTION DES POINTS
          if (currentView === 'teacher-actions') {
            const selectedPlayerData = players.find(p => p.name === selectedStudent);
            if (!selectedPlayerData) return null;

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4">
                <div className="max-w-4xl mx-auto">
                  {/* En-tête */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 md:p-6 mb-6">
                    <div className="flex justify-between items-center mb-4">
                      <button
                        onClick={() => setCurrentView('teacher-players')}
                        className="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg transition-colors text-sm md:text-base"
                      >
                        ← Retour
                      </button>
                      {loading && <div className="text-white text-sm">⏳ Attribution...</div>}
                    </div>
                    
                    <div className="text-center">
                      <div className={`bg-gradient-to-r ${franchiseColors[selectedPlayerData.franchise]} p-4 rounded-lg inline-block mb-4`}>
                        <div className="flex items-center space-x-3">
                          <span className={`${getFranchiseAvatar(selectedPlayerData.franchise).class} text-3xl md:text-4xl`}>
                            {getFranchiseAvatar(selectedPlayerData.franchise).emoji}
                          </span>
                          <div className="text-left">
                            <h1 className="text-2xl md:text-3xl font-bold text-white">{selectedPlayerData.name}</h1>
                            <p className="text-white/90">{selectedPlayerData.franchise}</p>
                          </div>
                        </div>
                      </div>
                      
                      <div className="flex justify-center items-center space-x-3 mb-2">
                        <span className="text-3xl">{getBadge(selectedPlayerData.score).emoji}</span>
                        <span className="text-2xl font-bold text-white">{selectedPlayerData.score} points</span>
                      </div>
                      <div className="text-lg text-yellow-300 font-semibold">
                        {getBadge(selectedPlayerData.score).name}
                      </div>
                    </div>
                  </div>

                  {/* Actions positives */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 md:p-6 mb-6">
                    <h2 className="text-xl md:text-2xl font-bold text-green-400 mb-4 text-center">
                      ✅ Actions Positives
                    </h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                      {positiveActions.map((action, index) => (
                        <button
                          key={`pos-${index}`}
                          onClick={() => {
                            addPoints(selectedPlayerData.name, action.points, action.label);
                            setCurrentView('teacher-players');
                          }}
                          className="bg-green-600/80 hover:bg-green-500 text-white p-3 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
                          disabled={loading}
                        >
                          <div className="flex justify-between items-center">
                            <span className="text-left text-sm md:text-base font-medium leading-tight">
                              {action.label.replace(/^🏀|^📚/, '')}
                            </span>
                            <span className="text-green-200 font-bold text-lg">
                              +{action.points}
                            </span>
                          </div>
                          {action.category && (
                            <div className="text-xs text-green-200 mt-1 text-left">
                              {action.category === 'sport' ? '🏀 Sport' : '📚 Scolaire'}
                            </div>
                          )}
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* Actions négatives */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 md:p-6">
                    <h2 className="text-xl md:text-2xl font-bold text-red-400 mb-4 text-center">
                      ⛔ Actions Négatives
                    </h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                      {negativeActions.map((action, index) => (
                        <button
                          key={`neg-${index}`}
                          onClick={() => {
                            addPoints(selectedPlayerData.name, action.points, action.label);
                            setCurrentView('teacher-players');
                          }}
                          className="bg-red-600/80 hover:bg-red-500 text-white p-3 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
                          disabled={loading}
                        >
                          <div className="flex justify-between items-center">
                            <span className="text-left text-sm md:text-base font-medium leading-tight">
                              {action.label}
                            </span>
                            <span className="text-red-200 font-bold text-lg">
                              {action.points}
                            </span>
                          </div>
                          {action.category && (
                            <div className="text-xs text-red-200 mt-1 text-left">
                              {action.category === 'sport' ? '🏀 Sport' : '📚 Scolaire'}
                            </div>
                          )}
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // ADMINISTRATION PROFESSEUR
          if (currentView === 'teacher-admin') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">⚙️ Administration des Élèves</h1>
                    <button
                      onClick={() => setCurrentView('teacher-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ← Retour Tableau de Bord
                    </button>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        ➕ Ajouter un Élève
                      </h2>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            Nom de l'élève
                          </label>
                          <input
                            type="text"
                            value={newStudentName}
                            onChange={(e) => setNewStudentName(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                            placeholder="Prénom Nom..."
                          />
                        </div>
                        
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            Franchise
                          </label>
                          <select
                            value={newStudentFranchise}
                            onChange={(e) => setNewStudentFranchise(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white border border-white/30 focus:border-white/70 focus:outline-none"
                          >
                            <option value="Minotaurs" className="text-black">Minotaurs</option>
                            <option value="Krakens" className="text-black">Krakens</option>
                            <option value="Phoenix" className="text-black">Phoenix</option>
                            <option value="Werewolves" className="text-black">Werewolves</option>
                          </select>
                        </div>
                        
                        <button
                          onClick={addStudent}
                          className="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg transition-colors font-bold"
                        >
                          ➕ Ajouter l'Élève
                        </button>
                      </div>
                    </div>

                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        🗑️ Supprimer un Élève
                      </h2>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            Sélectionner un élève
                          </label>
                          <select
                            value={selectedStudent}
                            onChange={(e) => setSelectedStudent(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white border border-white/30 focus:border-white/70 focus:outline-none"
                          >
                            <option value="" className="text-black">-- Choisir un élève --</option>
                            {players
                              .sort((a, b) => a.name.localeCompare(b.name))
                              .map(player => (
                                <option key={player.name} value={player.name} className="text-black">
                                  {player.name} ({player.franchise})
                                </option>
                              ))}
                          </select>
                        </div>
                        
                        <button
                          onClick={() => selectedStudent && removeStudent(selectedStudent)}
                          disabled={!selectedStudent}
                          className="w-full bg-red-600 hover:bg-red-500 disabled:bg-gray-500 disabled:cursor-not-allowed text-white py-3 rounded-lg transition-colors font-bold"
                        >
                          🗑️ Supprimer l'Élève
                        </button>
                        
                        <p className="text-red-300 text-sm text-center">
                          ⚠️ Cette action est irréversible !
                        </p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-8 bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">
                      📋 Liste Actuelle des Élèves
                    </h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg franchise-card`}>
                            <div className="flex items-center justify-center mb-3">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                              <h3 className="text-xl font-bold text-white ml-2">{franchise}</h3>
                            </div>
                            <div className="space-y-2">
                              {getSortedPlayers(franchise).map(player => (
                                <div key={player.name} className="bg-white/20 p-2 rounded text-white text-sm">
                                  <div className="flex justify-between items-center">
                                    <span>{player.name}</span>
                                    <span className="font-bold">{player.score} pts</span>
                                  </div>
                                </div>
                              ))}
                            </div>
                            <div className="text-center mt-3 text-white/80 text-sm">
                              {getSortedPlayers(franchise).length} élève(s)
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // TABLEAU DE BORD ÉLÈVE
          if (currentView === 'student-dashboard') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">👨‍🎓 Espace Élève</h1>
                    <button
                      onClick={() => {
                        setCurrentView('home');
                        setUserType(null);
                      }}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ← Retour Accueil
                    </button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button
                      onClick={() => setCurrentView('student-search')}
                      className="bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">🔍</div>
                      <h3 className="text-xl font-bold">Mon Score</h3>
                      <p className="text-blue-100 text-sm">Voir mon historique personnel</p>
                    </button>

                    <button
                      onClick={() => setCurrentView('badges')}
                      className="bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">🏅</div>
                      <h3 className="text-xl font-bold">Badges</h3>
                      <p className="text-purple-100 text-sm">Découvrir les badges</p>
                    </button>

                      <button
  onClick={() => setCurrentView('grades')}
  className="bg-gradient-to-r from-orange-600 to-orange-800 hover:from-orange-500 hover:to-orange-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
>
  <div className="text-4xl mb-2">🏀</div>
  <h3 className="text-xl font-bold">Grades</h3>
  <p className="text-orange-100 text-sm">Découvrir les grades</p>
</button>
                    
                    <button
                      onClick={() => setCurrentView('rankings')}
                      className="bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">🏆</div>
                      <h3 className="text-xl font-bold">Classements</h3>
                      <p className="text-amber-100 text-sm">Voir tous les classements</p>
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h3 className="text-2xl font-bold text-white mb-6 text-center">
                      🏠 Les Quatre Franchises
                    </h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const franchisePlayers = getSortedPlayers(franchise);
                        const totalPoints = franchisePlayers.reduce((sum, player) => sum + player.score, 0);
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg text-center franchise-card`}>
                            <div className="flex items-center justify-center mb-2">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                            </div>
                            <h4 className="font-bold text-white text-lg">{franchise}</h4>
                            <div className="text-2xl font-bold text-white">{totalPoints}</div>
                            <div className="text-sm text-white/80">{franchisePlayers.length} élèves</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // RECHERCHE ÉLÈVE
          if (currentView === 'student-search') {
            
            const searchPlayer = async () => {
              if (!searchName.trim()) {
                alert('Veuillez entrer votre nom');
                return;
              }

              try {
                const response = await fetch(`/api/player/${encodeURIComponent(searchName.trim())}`);
                if (response.ok) {
                  const player = await response.json();
                  setFoundPlayer(player);
                  
                  const historyResponse = await fetch(`/api/history/${encodeURIComponent(searchName.trim())}`);
                  const history = await historyResponse.json();
                  setSearchHistory(history);
                } else {
                  setFoundPlayer(null);
                  setSearchHistory([]);
                  alert('Élève non trouvé. Vérifiez l\'orthographe de votre nom.');
                }
              } catch (error) {
                alert('Erreur lors de la recherche');
              }
            };

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">🔍 Rechercher Mon Score</h1>
                    <button
                      onClick={() => setCurrentView('student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ← Retour
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">
                      Entrez votre nom complet
                    </h2>
                    <div className="flex space-x-4">
                      <input
                        type="text"
                        value={searchName}
                        onChange={(e) => setSearchName(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && searchPlayer()}
                        className="flex-1 px-4 py-3 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none text-lg"
                        placeholder="Votre prénom et nom..."
                      />
                      <button
                        onClick={searchPlayer}
                        className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-lg transition-colors font-bold"
                      >
                        🔍 Rechercher
                      </button>
                    </div>
                  </div>

                  {foundPlayer && (
                    <div className="space-y-6">
                      <div className={`bg-gradient-to-r ${franchiseColors[foundPlayer.franchise]} p-6 rounded-xl franchise-card`}>
                        <div className="text-center">
                          <h2 className="text-3xl font-bold text-white mb-2">{foundPlayer.name}</h2>
                          <div className="text-xl text-white/90 mb-4 flex items-center justify-center space-x-3">
                            <span>Franchise:</span>
                            <div className="flex items-center space-x-2">
                              <span className={`franchise-avatar ${getFranchiseAvatar(foundPlayer.franchise).class}`}>
                                {getFranchiseAvatar(foundPlayer.franchise).emoji}
                              </span>
                              <span className="font-bold">{foundPlayer.franchise}</span>
                            </div>
                          </div>
                          <div className="mb-4">
                            <div className="inline-flex items-center space-x-2 bg-black/30 px-4 py-2 rounded-full">
                              <span className="text-3xl">{getBadge(foundPlayer.score).emoji}</span>
                              <span className={`text-xl font-bold ${getBadge(foundPlayer.score).color}`}>
                                {getBadge(foundPlayer.score).name}
                              </span>
                            </div>
                          </div>
                          <div className="text-5xl font-bold text-white">{foundPlayer.score} points</div>
                        </div>
                      </div>
{foundPlayer.badges && foundPlayer.badges.length > 0 && (
  <div className="mt-6 bg-white/10 backdrop-blur-sm rounded-xl p-6">
    <h4 className="text-2xl font-bold text-white mb-4 text-center">
      🏅 Mes Badges ({foundPlayer.badges.length})
    </h4>
    <div className="flex flex-wrap gap-3 justify-center">
      {foundPlayer.badges.map((badge, index) => (
        <div key={index} className="bg-black/30 px-4 py-3 rounded-lg flex items-center gap-2 hover:bg-black/50 transition-colors">
          <span className="text-3xl">{badge.badge_emoji}</span>
          <div>
            <div className="text-white font-bold">{badge.badge_name}</div>
            <div className="text-yellow-300 text-xs">+{badge.points || 0} pts</div>
          </div>
        </div>
      ))}
    </div>
  </div>
)}
                      <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                        <h3 className="text-2xl font-bold text-white mb-6 text-center">
                          📋 Mon Historique
                        </h3>
                        <div className="space-y-3 max-h-96 overflow-y-auto">
                          {searchHistory.length > 0 ? (
                            searchHistory.map((entry, index) => (
                              <div key={index} className="bg-white/20 p-4 rounded-lg">
                                <div className="flex justify-between items-start">
                                  <div>
                                    <div className="font-semibold text-white">{entry.action}</div>
                                    <div className="text-sm text-white/80">{entry.timestamp}</div>
                                    {entry.teacher_name && entry.teacher_name !== 'Anonyme' && (
                                      <div className="text-xs text-white/60">Par: {entry.teacher_name}</div>
                                    )}
                                  </div>
                                  <div className="text-right">
                                    <div className={`text-lg font-bold ${entry.points > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                      {entry.points > 0 ? '+' : ''}{entry.points}
                                    </div>
                                    <div className="text-sm text-white/70">Total: {entry.new_total}</div>
                                  </div>
                                </div>
                              </div>
                            ))
                          ) : (
                            <p className="text-white/70 text-center">Aucun historique disponible</p>
                          )}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // PAGE CLASSEMENTS AMÉLIORÉE - Remplace la section "PAGE CLASSEMENTS" existante
if (currentView === 'rankings') {
  
  if (loadingStats) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8 flex items-center justify-center">
        <div className="text-white text-2xl">📊 Chargement des statistiques...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4 md:p-8">
      <div className="max-w-7xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-2xl md:text-4xl font-bold text-white">🏆 Classements Complets</h1>
          <button
            onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
            className="bg-gray-600 hover:bg-gray-500 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg transition-colors"
          >
            ← Retour
          </button>
        </div>

        {/* MVP de la semaine avec vraies données */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h2 className="text-2xl font-bold text-amber-400 mb-4 text-center flex items-center justify-center">
              📚 MVP Académique de la Semaine
            </h2>
            {mvpData.mvpAcademic ? (
              <div className={`bg-gradient-to-r ${franchiseColors[mvpData.mvpAcademic.franchise]} p-6 rounded-lg text-center`}>
                <div className="text-4xl mb-2">{getBadge(mvpData.mvpAcademic.total_score).emoji}</div>
                <h3 className="text-2xl font-bold text-white mb-1">{mvpData.mvpAcademic.name}</h3>
                <p className="text-white/80 mb-2">{mvpData.mvpAcademic.franchise}</p>
                <div className="text-3xl font-bold text-white">+{mvpData.mvpAcademic.weekly_points} pts</div>
                <div className="text-sm text-white/70">cette semaine • Total: {mvpData.mvpAcademic.total_score}</div>
              </div>
            ) : (
              <div className="bg-white/20 p-6 rounded-lg text-center">
                <div className="text-4xl mb-2">📚</div>
                <p className="text-white/70">Aucune action académique cette semaine</p>
              </div>
            )}
          </div>

          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h2 className="text-2xl font-bold text-orange-400 mb-4 text-center flex items-center justify-center">
              🏀 MVP Sport de la Semaine
            </h2>
            {mvpData.mvpSport ? (
              <div className={`bg-gradient-to-r ${franchiseColors[mvpData.mvpSport.franchise]} p-6 rounded-lg text-center`}>
                <div className="text-4xl mb-2">{getBadge(mvpData.mvpSport.total_score).emoji}</div>
                <h3 className="text-2xl font-bold text-white mb-1">{mvpData.mvpSport.name}</h3>
                <p className="text-white/80 mb-2">{mvpData.mvpSport.franchise}</p>
                <div className="text-3xl font-bold text-white">+{mvpData.mvpSport.weekly_points} pts</div>
                <div className="text-sm text-white/70">cette semaine • Total: {mvpData.mvpSport.total_score}</div>
              </div>
            ) : (
              <div className="bg-white/20 p-6 rounded-lg text-center">
                <div className="text-4xl mb-2">🏀</div>
                <p className="text-white/70">Aucune action sportive cette semaine</p>
              </div>
            )}
          </div>
        </div>

        {/* Top 5 par catégorie avec vraies données */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h2 className="text-2xl font-bold text-blue-400 mb-6 text-center">📚 Top 5 Académique</h2>
            <div className="space-y-3">
              {top5Data.academic.map((player, index) => (
                <div
                  key={player.name}
                  className={`bg-gradient-to-r ${franchiseColors[player.franchise]} p-4 rounded-lg flex justify-between items-center shadow-md`}
                >
                  <div className="flex items-center space-x-3">
                    <span className="text-lg font-bold text-white">#{index + 1}</span>
                    <span className="text-2xl">{getBadge(player.total_score).emoji}</span>
                    <div>
                      <span className="text-lg font-semibold text-white">{player.name}</span>
                      <div className="text-sm text-white/80">{player.franchise}</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className="text-lg font-bold text-white">{player.category_points} pts</div>
                    <div className="text-xs text-white/70">académiques</div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h2 className="text-2xl font-bold text-orange-400 mb-6 text-center">🏀 Top 5 Sport</h2>
            <div className="space-y-3">
              {top5Data.sport.map((player, index) => (
                <div
                  key={player.name}
                  className={`bg-gradient-to-r ${franchiseColors[player.franchise]} p-4 rounded-lg flex justify-between items-center shadow-md`}
                >
                  <div className="flex items-center space-x-3">
                    <span className="text-lg font-bold text-white">#{index + 1}</span>
                    <span className="text-2xl">{getBadge(player.total_score).emoji}</span>
                    <div>
                      <span className="text-lg font-semibold text-white">{player.name}</span>
                      <div className="text-sm text-white/80">{player.franchise}</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className="text-lg font-bold text-white">{player.category_points} pts</div>
                    <div className="text-xs text-white/70">sportifs</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Statistiques par franchise avec vraies données */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
          <h2 className="text-2xl font-bold text-white mb-6 text-center">⚖️ Équilibre Sport/Académique par Franchise</h2>
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="space-y-4">
              {franchiseBalance.map((franchise, index) => {
                const avatar = getFranchiseAvatar(franchise.franchise);
                return (
                  <div
                    key={franchise.franchise}
                    className={`bg-gradient-to-r ${franchiseColors[franchise.franchise]} p-4 rounded-lg`}
                  >
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center space-x-3">
                        <span className={`franchise-avatar ${avatar.class} text-2xl`}>
                          {avatar.emoji}
                        </span>
                        <span className="text-xl font-bold text-white">{franchise.franchise}</span>
                        {index === 0 && <span className="text-yellow-300 text-sm">⚖️ Plus équilibrée</span>}
                      </div>
                      <span className="text-lg font-bold text-white">{franchise.total_points} pts</span>
                    </div>
                    <div className="grid grid-cols-2 gap-4 text-sm mb-2">
                      <div className="text-center">
                        <div className="text-blue-300 font-bold">{franchise.academic_points}</div>
                        <div className="text-white/70">Académique ({franchise.academic_percent}%)</div>
                      </div>
                      <div className="text-center">
                        <div className="text-orange-300 font-bold">{franchise.sport_points}</div>
                        <div className="text-white/70">Sport ({franchise.sport_percent}%)</div>
                      </div>
                    </div>
                    <div className="text-center">
                      <div className="text-white/80 text-xs">
                        Moy./joueur: {franchise.avg_per_player} pts • Équilibre: {franchise.balance_score}%
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
            
            {/* Graphique visuel avec vraies données */}
            <div className="bg-white/20 rounded-lg p-4">
              <h3 className="text-white font-bold mb-4 text-center">Répartition Sport vs Académique</h3>
              <div className="space-y-3">
                {franchiseBalance.map(franchise => {
                  return (
                    <div key={franchise.franchise} className="mb-4">
                      <div className="flex justify-between text-white text-sm mb-1">
                        <span>{franchise.franchise}</span>
                        <span>{franchise.total_points} pts</span>
                      </div>
                      <div className="w-full bg-white/20 rounded-full h-4 overflow-hidden">
                        <div className="h-full flex">
                          <div 
                            className="bg-blue-500 transition-all duration-500"
                            style={{ width: `${franchise.academic_percent}%` }}
                            title={`Académique: ${franchise.academic_percent}%`}
                          ></div>
                          <div 
                            className="bg-orange-500 transition-all duration-500"
                            style={{ width: `${franchise.sport_percent}%` }}
                            title={`Sport: ${franchise.sport_percent}%`}
                          ></div>
                        </div>
                      </div>
                      <div className="flex justify-between text-xs text-white/60 mt-1">
                        <span>📚 {franchise.academic_percent}%</span>
                        <span>🏀 {franchise.sport_percent}%</span>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>

        {/* Hall of Fame avec vraies données */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
          <h2 className="text-2xl font-bold text-yellow-400 mb-6 text-center">🏛️ Hall of Fame</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {hallOfFameData.recordHolder && (
              <div className={`bg-gradient-to-r ${franchiseColors[hallOfFameData.recordHolder.franchise]} p-4 rounded-lg text-center border-2 border-yellow-400`}>
                <div className="text-3xl mb-2">👑</div>
                <h3 className="text-white font-bold">Record Absolu</h3>
                <div className="text-2xl font-bold text-white">{hallOfFameData.recordHolder.name}</div>
                <div className="text-white/80">{hallOfFameData.recordHolder.franchise}</div>
                <div className="text-xl font-bold text-yellow-300">{hallOfFameData.recordHolder.score} points</div>
              </div>
            )}

            {hallOfFameData.mostBadges && (
              <div className={`bg-gradient-to-r ${franchiseColors[hallOfFameData.mostBadges.franchise]} p-4 rounded-lg text-center border-2 border-purple-400`}>
                <div className="text-3xl mb-2">🏅</div>
                <h3 className="text-white font-bold">Roi des Badges</h3>
                <div className="text-2xl font-bold text-white">{hallOfFameData.mostBadges.name}</div>
                <div className="text-white/80">{hallOfFameData.mostBadges.franchise}</div>
                <div className="text-xl font-bold text-purple-300">{hallOfFameData.mostBadges.badge_count} badges</div>
              </div>
            )}

            <div className="space-y-3">
              <h3 className="text-white font-bold text-center">🎯 Premiers Paliers</h3>
              {[
                { threshold: 50, player: hallOfFameData.firstTo50, emoji: '⭐' },
                { threshold: 100, player: hallOfFameData.firstTo100, emoji: '🌟' },
                { threshold: 150, player: hallOfFameData.firstTo150, emoji: '🔥' },
                { threshold: 200, player: hallOfFameData.firstTo200, emoji: '🏛️' }
              ].map(({ threshold, player, emoji }) => (
                player && (
                  <div key={threshold} className="bg-white/20 p-2 rounded flex justify-between items-center">
                    <span className="text-white text-sm">{emoji} {threshold} pts</span>
                    <span className="text-white font-bold text-sm">{player.name}</span>
                  </div>
                )
              ))}
            </div>
          </div>
        </div>

        {/* Classements classiques */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h2 className="text-2xl font-bold text-white mb-6 text-center">🏆 Classement des Franchises</h2>
            <div className="space-y-4">
              {franchiseRankings.map(({ franchise, score, rank }) => {
                const avatar = getFranchiseAvatar(franchise);
                return (
                  <div
                    key={franchise}
                    className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg flex justify-between items-center shadow-lg franchise-card`}
                  >
                    <div className="flex items-center space-x-3">
                      <span className="text-2xl font-bold text-white">#{rank}</span>
                      <span className={`franchise-avatar ${avatar.class}`}>
                        {avatar.emoji}
                      </span>
                      <span className="text-xl font-semibold text-white">{franchise}</span>
                    </div>
                    <span className="text-2xl font-bold text-white">{score} pts</span>
                  </div>
                );
              })}
            </div>
          </div>

          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h2 className="text-2xl font-bold text-white mb-6 text-center">👑 Classement Général</h2>
            <div className="space-y-2 max-h-96 overflow-y-auto">
              {playerRankings.slice(0, 20).map((player, index) => {
                const badge = getBadge(player.score);
                return (
                  <div
                    key={player.name}
                    className={`bg-gradient-to-r ${franchiseColors[player.franchise]} p-3 rounded-lg flex justify-between items-center shadow-md`}
                  >
                    <div className="flex items-center space-x-3">
                      <span className="text-lg font-bold text-white">#{index + 1}</span>
                      <span className="text-2xl">{badge.emoji}</span>
                      <div>
                        <span className="text-lg font-semibold text-white">{player.name}</span>
                        <div className="text-sm text-white/80">{player.franchise}</div>
                      </div>
                    </div>
                    <span className="text-lg font-bold text-white">{player.score} pts</span>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
          // PAGE DES BADGES
          if (currentView === 'badges') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-7xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">🏅 Collection de Badges</h1>
                    <button
                      onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ← Retour
                    </button>
                  </div>

                  {/* Badges Individuels */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">👤 Badges Individuels</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                      {Object.values(individualBadges).map(badge => {
                        // Compter combien de joueurs ont ce badge
                        const playersWithBadge = Object.entries(playerBadges).filter(([player, badges]) =>
                          badges?.some(b => b.id === badge.id)
                        ).map(([player]) => player);

                        return (
                          <div key={badge.id} className={`rounded-lg p-4 border-2 ${getRarityColor(badge.rarity)}`}>
                            <div className="flex items-center space-x-3 mb-3">
                              <span className="text-4xl">{badge.emoji}</span>
                              <div className="flex-1">
                                <h3 className="text-white font-bold text-lg">{badge.name}</h3>
                                <p className="text-white/70 text-sm">{badge.description}</p>
                                <p className="text-yellow-300 text-xs mt-1">+{badge.points} pts</p>
                              </div>
                            </div>
                            {playersWithBadge.length > 0 && (
                              <div className="text-white/60 text-xs mt-2 pt-2 border-t border-white/20">
                                <p>Obtenu par: {playersWithBadge.length} joueur(s)</p>
                                <p className="truncate">{playersWithBadge.slice(0, 3).join(', ')}{playersWithBadge.length > 3 ? '...' : ''}</p>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Badges Collectifs */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">🏠 Badges Collectifs</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                      {Object.values(collectiveBadges).map(badge => {
                        // Compter combien de franchises ont ce badge
                        const franchisesWithBadge = Object.entries(franchiseBadges).filter(([franchise, badges]) =>
                          badges?.some(b => b.id === badge.id)
                        ).map(([franchise]) => franchise);

                        return (
                          <div key={badge.id} className={`rounded-lg p-4 border-2 ${getRarityColor(badge.rarity)}`}>
                            <div className="flex items-center space-x-3 mb-3">
                              <span className="text-4xl">{badge.emoji}</span>
                              <div className="flex-1">
                                <h3 className="text-white font-bold text-lg">{badge.name}</h3>
                                <p className="text-white/70 text-sm">{badge.description}</p>
                                <p className="text-yellow-300 text-xs mt-1">+{badge.points} pts franchise</p>
                              </div>
                            </div>
                            {franchisesWithBadge.length > 0 && (
                              <div className="text-white/60 text-xs mt-2 pt-2 border-t border-white/20">
                                <p>Obtenu par: {franchisesWithBadge.join(', ')}</p>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }
// PAGE DES GRADES
if (currentView === 'grades') {
  // Définition complète de tous les grades
  const allGrades = [
    // GRADES NÉGATIFS
    { emoji: '🗑️', name: 'Scrub', minScore: -1000, maxScore: -50, color: 'from-red-900 to-red-700', description: 'Le pire niveau possible' },
    { emoji: '🪑', name: 'Benchwarmer', minScore: -50, maxScore: -25, color: 'from-red-700 to-red-500', description: 'Cloué sur le banc' },
    { emoji: '📉', name: 'Plot', minScore: -25, maxScore: 0, color: 'from-gray-700 to-gray-500', description: 'Personnage sans importance' },
    
    // GRADES DÉBUTANTS
    { emoji: '👶', name: 'Freshman', minScore: 0, maxScore: 10, color: 'from-yellow-600 to-yellow-500', description: 'Première année, apprend les bases' },
    { emoji: '🏀', name: 'Rookie', minScore: 10, maxScore: 25, color: 'from-amber-600 to-amber-500', description: 'Débutant prometteur' },
    
    // GRADES DÉVELOPPEMENT
    { emoji: '🏃', name: 'Sixth Man', minScore: 25, maxScore: 50, color: 'from-green-700 to-green-600', description: 'Premier remplaçant de qualité' },
    { emoji: '⭐', name: 'Starting Five', minScore: 50, maxScore: 75, color: 'from-green-600 to-green-500', description: 'Titulaire indiscutable' },
    
    // GRADES CONFIRMÉS
    { emoji: '💎', name: 'Franchise Player', minScore: 75, maxScore: 100, color: 'from-blue-700 to-blue-600', description: 'Pilier de l\'équipe' },
    { emoji: '🌟', name: 'All-Star', minScore: 100, maxScore: 150, color: 'from-blue-600 to-blue-500', description: 'Sélectionné parmi l\'élite' },
    
    // GRADES ÉLITE
    { emoji: '🔥', name: 'Superstar', minScore: 150, maxScore: 200, color: 'from-orange-600 to-red-500', description: 'Phénomène basketball' },
    { emoji: '🏛️', name: 'Hall of Fame', minScore: 200, maxScore: 250, color: 'from-yellow-600 to-yellow-500', description: 'Légende du sport' },
    
    // GRADE ULTIME
    { emoji: '🐐', name: 'GOAT', minScore: 250, maxScore: 9999, color: 'from-purple-600 to-pink-600', description: 'Greatest Of All Time' }
  ];

  // Compter combien d'élèves ont chaque grade
  const getPlayersInGrade = (minScore, maxScore) => {
    return players.filter(p => p.score >= minScore && p.score < maxScore).length;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
      <div className="max-w-7xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-4xl font-bold text-white">🏀 Système de Grades Basketball</h1>
          <button
            onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
            className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
          >
            ← Retour
          </button>
        </div>

        {/* Progression visuelle */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
          <h2 className="text-2xl font-bold text-white mb-6 text-center">🎯 Échelle de Progression</h2>
          <div className="relative">
            {/* Barre de progression */}
            <div className="absolute left-0 right-0 top-1/2 h-2 bg-white/20 rounded-full transform -translate-y-1/2"></div>
            
            {/* Points clés */}
            <div className="relative flex justify-between mb-8">
              <div className="text-center">
                <div className="w-4 h-4 bg-red-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">-50</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-yellow-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">0</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-green-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">50</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-blue-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">100</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-orange-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">150</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-purple-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">250+</div>
              </div>
            </div>
          </div>
        </div>

        {/* Liste des grades */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {allGrades.map((grade, index) => {
            const playersCount = getPlayersInGrade(grade.minScore, grade.maxScore);
            const isNegative = grade.minScore < 0;
            
            return (
              <div 
                key={index} 
                className={`bg-gradient-to-r ${grade.color} p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300`}
              >
                <div className="text-center">
                  <div className="text-6xl mb-3">{grade.emoji}</div>
                  <h3 className="text-2xl font-bold text-white mb-2">{grade.name}</h3>
                  <p className="text-white/90 mb-3">{grade.description}</p>
                  
                  <div className="bg-black/30 rounded-lg p-3 mb-3">
                    <div className="text-white font-bold">
                      {grade.maxScore === 9999 ? 
                        `${grade.minScore}+ points` : 
                        `${grade.minScore} à ${grade.maxScore} points`
                      }
                    </div>
                  </div>
                  
                  {userType === 'teacher' && (
                    <div className="text-white/80 text-sm">
                      {playersCount > 0 ? (
                        <span className="font-bold">{playersCount} élève{playersCount > 1 ? 's' : ''}</span>
                      ) : (
                        <span className="text-white/50">Aucun élève</span>
                      )}
                    </div>
                  )}
                  
                  {isNegative && (
                    <div className="mt-2 text-red-200 text-xs">
                      ⚠️ Zone de danger
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>

        {/* Statistiques pour les profs */}
        {userType === 'teacher' && (
          <div className="mt-8 bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h3 className="text-2xl font-bold text-white mb-4">📊 Répartition Actuelle</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="text-center">
                <div className="text-3xl font-bold text-red-400">
                  {players.filter(p => p.score < 0).length}
                </div>
                <div className="text-white/70">En difficulté</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-yellow-400">
                  {players.filter(p => p.score >= 0 && p.score < 50).length}
                </div>
                <div className="text-white/70">Débutants</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-green-400">
                  {players.filter(p => p.score >= 50 && p.score < 150).length}
                </div>
                <div className="text-white/70">Confirmés</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-purple-400">
                  {players.filter(p => p.score >= 150).length}
                </div>
                <div className="text-white/70">Élite</div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
          // Return principal avec le modal d'historique et notifications
          return (
            <>
              {/* Système de notifications */}
              <NotificationSystem notifications={notifications} />
              
              {selectedPlayerHistory && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-xl p-6 max-w-md w-full max-h-96 overflow-y-auto">
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-xl font-bold">Historique de {selectedPlayerHistory}</h3>
                      <button
                        onClick={() => setSelectedPlayerHistory(null)}
                        className="text-gray-500 hover:text-gray-700 text-xl"
                      >
                        ×
                      </button>
                    </div>
                    <div className="space-y-2">
                      {playerHistory.length > 0 ? (
                        playerHistory.map((entry, index) => (
                          <div key={index} className="border-l-4 border-blue-500 pl-3 py-2">
                            <div className="font-semibold">{entry.action}</div>
                            <div className="text-sm text-gray-600">
                              {entry.points > 0 ? '+' : ''}{entry.points} points
                            </div>
                            <div className="text-xs text-gray-500">
                              {entry.timestamp} • Total: {entry.new_total} pts
                              {entry.teacher_name && entry.teacher_name !== 'Anonyme' && (
                                <span> • Par: {entry.teacher_name}</span>
                              )}
                            </div>
                          </div>
                        ))
                      ) : (
                        <p className="text-gray-500 text-center">Aucun historique disponible</p>
                      )}
                    </div>
                  </div>
                </div>
              )}
            </>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
